<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>投资日记 · 2026年2月11日：技术分析实战与春节策略</title>
    <link href="/2026/02/11/2026-02-11-fund-daily-review/"/>
    <url>/2026/02/11/2026-02-11-fund-daily-review/</url>
    
    <content type="html"><![CDATA[<h1 id="投资日记-·-2026年2月11日"><a href="#投资日记-·-2026年2月11日" class="headerlink" title="投资日记 · 2026年2月11日"></a>投资日记 · 2026年2月11日</h1><h2 id="市场概况"><a href="#市场概况" class="headerlink" title="市场概况"></a>市场概况</h2><h3 id="全球市场动态"><a href="#全球市场动态" class="headerlink" title="全球市场动态"></a>全球市场动态</h3><p>2026年2月初，全球市场呈现明显的分化格局：</p><ul><li><strong>黄金市场</strong>：受地缘政治风险和避险情绪推动，国际金价持续走高</li><li><strong>港股市场</strong>：沪港深黄金板块表现强势，带动相关基金上涨</li><li><strong>A股市场</strong>：科创创业板震荡调整，资金轮动明显</li><li><strong>亚太市场</strong>：整体平稳，港股通资金持续流入</li></ul><h3 id="板块轮动"><a href="#板块轮动" class="headerlink" title="板块轮动"></a>板块轮动</h3><table><thead><tr><th>板块</th><th>表现</th><th>驱动因素</th></tr></thead><tbody><tr><td>黄金概念</td><td>强势</td><td>避险情绪 + 地缘政治</td></tr><tr><td>科创创业</td><td>调整</td><td>估值消化 + 资金轮动</td></tr><tr><td>港股通</td><td>稳定</td><td>资金流入 + 估值修复</td></tr></tbody></table><hr><h2 id="持仓分析"><a href="#持仓分析" class="headerlink" title="持仓分析"></a>持仓分析</h2><h3 id="组合概览"><a href="#组合概览" class="headerlink" title="组合概览"></a>组合概览</h3><table><thead><tr><th>类型</th><th>今日表现</th><th>20日收益</th><th>趋势</th></tr></thead><tbody><tr><td>沪港深黄金主题</td><td>+2~3%</td><td>+9%</td><td>震荡整理</td></tr><tr><td>亚太精选 QDII</td><td>+1.5%</td><td>+5%</td><td>上涨趋势</td></tr><tr><td>科创创业板 ETF</td><td>-1.8%</td><td>-4%</td><td>下跌趋势</td></tr></tbody></table><h3 id="今日操作"><a href="#今日操作" class="headerlink" title="今日操作"></a>今日操作</h3><h4 id="小额定投摊薄成本"><a href="#小额定投摊薄成本" class="headerlink" title="小额定投摊薄成本"></a>小额定投摊薄成本</h4><p>近期对科创创业板ETF进行了小额定投，摊薄持仓均价约 1%。</p><p><strong>操作逻辑</strong>：</p><ol><li>累计跌幅接近 3%，符合分批建仓策略</li><li>小额补仓，控制风险敞口</li><li>摊薄持仓均价，为后续反弹做准备</li></ol><hr><h2 id="技术分析实战"><a href="#技术分析实战" class="headerlink" title="技术分析实战"></a>技术分析实战</h2><h3 id="MA-移动平均线"><a href="#MA-移动平均线" class="headerlink" title="MA 移动平均线"></a>MA 移动平均线</h3><p><strong>定义</strong>：过去 N 天价格的平均值</p><table><thead><tr><th>指标</th><th>含义</th></tr></thead><tbody><tr><td>MA5</td><td>短期成本（1周）</td></tr><tr><td>MA20</td><td>中期成本（1个月）</td></tr><tr><td>MA60</td><td>长期成本（3个月）</td></tr></tbody></table><p><strong>信号</strong>：</p><ul><li>MA5 &gt; MA20 → 金叉，短期偏多</li><li>MA5 &lt; MA20 → 死叉，短期偏空</li></ul><h3 id="MACD-指数平滑异同移动平均线"><a href="#MACD-指数平滑异同移动平均线" class="headerlink" title="MACD 指数平滑异同移动平均线"></a>MACD 指数平滑异同移动平均线</h3><p><strong>定义</strong>：短期和长期趋势的速度差异</p><table><thead><tr><th>指标</th><th>含义</th></tr></thead><tbody><tr><td>DIF</td><td>快线，反映变化速度</td></tr><tr><td>DEA</td><td>慢线，平滑后的 DIF</td></tr><tr><td>MACD柱</td><td>加速&#x2F;减速程度</td></tr></tbody></table><p><strong>信号</strong>：</p><ul><li>MACD &gt; 0 → 多头，动能向上</li><li>MACD &lt; 0 → 空头，动能向下</li></ul><h3 id="各基金技术面"><a href="#各基金技术面" class="headerlink" title="各基金技术面"></a>各基金技术面</h3><h4 id="沪港深黄金主题"><a href="#沪港深黄金主题" class="headerlink" title="沪港深黄金主题"></a>沪港深黄金主题</h4><table><thead><tr><th>指标</th><th>信号</th></tr></thead><tbody><tr><td>MA5 vs MA20</td><td>中性</td></tr><tr><td>MACD</td><td>转正</td></tr><tr><td><strong>综合</strong></td><td>持有</td></tr></tbody></table><blockquote><p>MACD 由负转正，动能开始转强，加上黄金板块支撑，可以继续持有。</p></blockquote><h4 id="亚太精选-QDII"><a href="#亚太精选-QDII" class="headerlink" title="亚太精选 QDII"></a>亚太精选 QDII</h4><table><thead><tr><th>指标</th><th>信号</th></tr></thead><tbody><tr><td>MA5 vs MA20</td><td>金叉</td></tr><tr><td>MACD</td><td>向上</td></tr><tr><td><strong>综合</strong></td><td>持有</td></tr></tbody></table><blockquote><p>MA 金叉 + MACD 向上，趋势良好。</p></blockquote><h4 id="科创创业板-ETF"><a href="#科创创业板-ETF" class="headerlink" title="科创创业板 ETF"></a>科创创业板 ETF</h4><table><thead><tr><th>指标</th><th>信号</th></tr></thead><tbody><tr><td>MA5 vs MA20</td><td>死叉</td></tr><tr><td>MACD</td><td>向下</td></tr><tr><td><strong>综合</strong></td><td>观望</td></tr></tbody></table><blockquote><p>MA 死叉 + MACD 向下，短期趋势偏弱，符合分批建仓的逻辑（跌了才补）。</p></blockquote><hr><h2 id="春节风险提示"><a href="#春节风险提示" class="headerlink" title="春节风险提示"></a>春节风险提示</h2><h3 id="假期风险"><a href="#假期风险" class="headerlink" title="假期风险"></a>假期风险</h3><p>春节 A 股休市 8 天，需提前做好风险控制：</p><table><thead><tr><th>风险</th><th>影响</th><th>应对</th></tr></thead><tbody><tr><td>外围波动</td><td>无法操作</td><td>降低仓位</td></tr><tr><td>港股通关闭</td><td>无法买卖港股</td><td>提前规划</td></tr><tr><td>不确定性</td><td>突发消息</td><td>保持灵活</td></tr></tbody></table><h3 id="春节策略"><a href="#春节策略" class="headerlink" title="春节策略"></a>春节策略</h3><ol><li><strong>轻仓过年</strong>：降低整体仓位 20-30%</li><li><strong>保留现金</strong>：应对节后加仓机会</li><li><strong>监控外围</strong>：关注黄金、港股走势</li></ol><hr><h2 id="投资心得"><a href="#投资心得" class="headerlink" title="投资心得"></a>投资心得</h2><h3 id="今日感悟"><a href="#今日感悟" class="headerlink" title="今日感悟"></a>今日感悟</h3><blockquote><p>投资是一场马拉松，不是百米冲刺。</p></blockquote><h4 id="技术指标应用"><a href="#技术指标应用" class="headerlink" title="技术指标应用"></a>技术指标应用</h4><ul><li><strong>MA 看方向</strong>：价格在哪条成本线之上？</li><li><strong>MACD 看力度</strong>：涨&#x2F;跌的速度在加速还是减速？</li><li><strong>组合判断</strong>：MA + MACD 双重确认，提高胜率</li></ul><h4 id="补仓策略"><a href="#补仓策略" class="headerlink" title="补仓策略"></a>补仓策略</h4><ul><li><strong>分批买入</strong>：小额补仓，而非一次性梭哈</li><li><strong>控制仓位</strong>：留有余地，应对假期风险</li><li><strong>摊薄成本</strong>：降低持仓均价，回本更容易</li></ul><h4 id="心态管理"><a href="#心态管理" class="headerlink" title="心态管理"></a>心态管理</h4><ul><li><strong>不追涨杀跌</strong>：涨了不贪心，跌了不恐慌</li><li><strong>按计划执行</strong>：跌到目标位就补，不犹豫</li><li><strong>风险意识</strong>：提前考虑假期不确定性</li></ul><hr><h2 id="组合表现"><a href="#组合表现" class="headerlink" title="组合表现"></a>组合表现</h2><table><thead><tr><th>指标</th><th>表现</th></tr></thead><tbody><tr><td>今日预估</td><td>+1%</td></tr><tr><td>20日收益</td><td>+3% (加权)</td></tr><tr><td>整体趋势</td><td>偏震荡，结构性机会</td></tr></tbody></table><hr><h2 id="节前计划"><a href="#节前计划" class="headerlink" title="节前计划"></a>节前计划</h2><h3 id="短期操作"><a href="#短期操作" class="headerlink" title="短期操作"></a>短期操作</h3><ol><li>监控科创创业板：如果继续跌，跌破 3% 再考虑补</li><li>关注黄金主题：如果 MACD 持续转正，持有待涨</li><li>亚太 QDII：趋势良好，继续持有</li></ol><h3 id="节前准备"><a href="#节前准备" class="headerlink" title="节前准备"></a>节前准备</h3><ol><li>节前检查：决定是否减仓控风险</li><li>轻仓过年：降低假期不确定性</li><li>制定计划：节后根据走势决定操作</li></ol><hr><p><strong>互动话题</strong>：你在春节前会怎么操作？</p><ul><li>A. 持仓不动</li><li>B. 适当减仓</li><li>C. 加仓布局</li></ul><hr><p><em>投资日记 · 记录学习成长的每一天</em></p>]]></content>
    
    
    <categories>
      
      <category>投资复盘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>投资日记</tag>
      
      <tag>技术分析</tag>
      
      <tag>MA指标</tag>
      
      <tag>MACD指标</tag>
      
      <tag>投资策略</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>技术分析入门：MA 移动平均线 + MACD 实战指南</title>
    <link href="/2026/02/11/2026-02-11-ma-macd-technical-indicators/"/>
    <url>/2026/02/11/2026-02-11-ma-macd-technical-indicators/</url>
    
    <content type="html"><![CDATA[<h1 id="技术分析入门：MA-移动平均线-MACD-实战指南"><a href="#技术分析入门：MA-移动平均线-MACD-实战指南" class="headerlink" title="技术分析入门：MA 移动平均线 + MACD 实战指南"></a>技术分析入门：MA 移动平均线 + MACD 实战指南</h1><blockquote><p>两个最常用的技术指标，用通俗易懂的方式解释清楚</p></blockquote><p><img src="/img/ma_macd_indicator.png" alt="MA and MACD Indicators"></p><hr><h2 id="什么是-MA（移动平均线）？"><a href="#什么是-MA（移动平均线）？" class="headerlink" title="什么是 MA（移动平均线）？"></a>什么是 MA（移动平均线）？</h2><p><strong>一句话</strong>：把过去 N 天的价格平均一下，画成一条线</p><h3 id="三种常用-MA"><a href="#三种常用-MA" class="headerlink" title="三种常用 MA"></a>三种常用 MA</h3><table><thead><tr><th>指标</th><th>含义</th></tr></thead><tbody><tr><td>MA5</td><td>短期成本（1周）</td></tr><tr><td>MA20</td><td>中期成本（1个月）</td></tr><tr><td>MA60</td><td>长期成本（3个月）</td></tr></tbody></table><h3 id="如何看趋势？"><a href="#如何看趋势？" class="headerlink" title="如何看趋势？"></a>如何看趋势？</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">MA5</span> &gt; MA20 &gt; MA60  →  多头排列，上涨趋势<br>MA5 &lt; MA20 &lt; MA60  →  空头排列，下跌趋势<br></code></pre></td></tr></table></figure><h3 id="金叉-vs-死叉"><a href="#金叉-vs-死叉" class="headerlink" title="金叉 vs 死叉"></a>金叉 vs 死叉</h3><table><thead><tr><th>信号</th><th>条件</th><th>操作建议</th></tr></thead><tbody><tr><td>金叉</td><td>MA5 上穿 MA20</td><td>买入&#x2F;持有</td></tr><tr><td>死叉</td><td>MA5 下穿 MA20</td><td>卖出&#x2F;减仓</td></tr></tbody></table><p><strong>本质</strong>：MA 反映市场平均成本在哪，价格在成本线上方就强。</p><hr><h2 id="什么是-MACD？"><a href="#什么是-MACD？" class="headerlink" title="什么是 MACD？"></a>什么是 MACD？</h2><p><strong>一句话</strong>：衡量短期和长期趋势的速度差异</p><h3 id="三个要素"><a href="#三个要素" class="headerlink" title="三个要素"></a>三个要素</h3><table><thead><tr><th>指标</th><th>含义</th></tr></thead><tbody><tr><td>DIF</td><td>快线，反映变化速度</td></tr><tr><td>DEA</td><td>慢线，DIF 的平滑线</td></tr><tr><td>MACD柱</td><td>加速&#x2F;减速程度</td></tr></tbody></table><h3 id="如何看动能？"><a href="#如何看动能？" class="headerlink" title="如何看动能？"></a>如何看动能？</h3><table><thead><tr><th>信号</th><th>含义</th></tr></thead><tbody><tr><td>MACD &gt; 0</td><td>多头，动能向上</td></tr><tr><td>MACD &lt; 0</td><td>空头，动能向下</td></tr><tr><td>MACD 由负转正</td><td>动能转强，可能启动上涨</td></tr><tr><td>MACD 由正转负</td><td>动能转弱，可能开始下跌</td></tr></tbody></table><p><strong>本质</strong>：MACD 反映趋势动能在哪，值越大趋势越强。</p><hr><h2 id="MA-MACD-组合使用"><a href="#MA-MACD-组合使用" class="headerlink" title="MA + MACD 组合使用"></a>MA + MACD 组合使用</h2><p>单独看一个指标可能有假信号，组合使用更可靠：</p><p><img src="/img/signal_table.png" alt="Signal Summary Table"></p><h3 id="信号强度"><a href="#信号强度" class="headerlink" title="信号强度"></a>信号强度</h3><table><thead><tr><th>组合</th><th>说明</th></tr></thead><tbody><tr><td>MA 金叉 + MACD &gt; 0</td><td>双重确认，看涨</td></tr><tr><td>MA 死叉 + MACD &lt; 0</td><td>双重确认，看跌</td></tr><tr><td>MA 中性 + MACD ≈ 0</td><td>震荡，观望</td></tr></tbody></table><hr><h2 id="实战案例"><a href="#实战案例" class="headerlink" title="实战案例"></a>实战案例</h2><h3 id="案例-1：某黄金主题基金"><a href="#案例-1：某黄金主题基金" class="headerlink" title="案例 1：某黄金主题基金"></a>案例 1：某黄金主题基金</h3><table><thead><tr><th>指标</th><th>数值</th><th>信号</th></tr></thead><tbody><tr><td>MA5 vs MA20</td><td>粘合</td><td>中性</td></tr><tr><td>MACD</td><td>转正</td><td>动能向上</td></tr><tr><td><strong>综合</strong></td><td></td><td>持有待涨</td></tr></tbody></table><h3 id="案例-2：某科创创业板-ETF"><a href="#案例-2：某科创创业板-ETF" class="headerlink" title="案例 2：某科创创业板 ETF"></a>案例 2：某科创创业板 ETF</h3><table><thead><tr><th>指标</th><th>数值</th><th>信号</th></tr></thead><tbody><tr><td>MA5 vs MA20</td><td>死叉</td><td>偏空</td></tr><tr><td>MACD</td><td>向下</td><td>动能向下</td></tr><tr><td><strong>综合</strong></td><td></td><td>观望</td></tr></tbody></table><hr><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>⚠️ 技术指标不是万能的：</p><ol><li><strong>滞后性</strong>：基于历史数据，有延迟</li><li><strong>假信号</strong>：震荡行情中可能频繁失效</li><li><strong>综合判断</strong>：技术面 + 基本面 &#x3D; 更可靠</li></ol><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><table><thead><tr><th>指标</th><th>看什么</th></tr></thead><tbody><tr><td><strong>MA</strong></td><td>趋势方向</td></tr><tr><td><strong>MACD</strong></td><td>动能力度</td></tr></tbody></table><p><strong>一句话</strong>：MA 看方向，MACD 看力度，两者结合用，事半功倍。</p><hr><p><em>技术分析入门系列 · 持续更新</em></p>]]></content>
    
    
    <categories>
      
      <category>技术分析</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MA</tag>
      
      <tag>MACD</tag>
      
      <tag>技术指标</tag>
      
      <tag>投资入门</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>投资日记 · 2026年2月10日：止盈策略与节前思考</title>
    <link href="/2026/02/10/%E5%9F%BA%E9%87%91%E6%AF%8F%E6%97%A5%E5%A4%8D%E7%9B%98-2026-02-10/"/>
    <url>/2026/02/10/%E5%9F%BA%E9%87%91%E6%AF%8F%E6%97%A5%E5%A4%8D%E7%9B%98-2026-02-10/</url>
    
    <content type="html"><![CDATA[<h1 id="投资日记-·-2026年2月10日"><a href="#投资日记-·-2026年2月10日" class="headerlink" title="投资日记 · 2026年2月10日"></a>投资日记 · 2026年2月10日</h1><h2 id="今日持仓表现"><a href="#今日持仓表现" class="headerlink" title="今日持仓表现"></a>今日持仓表现</h2><table><thead><tr><th>类型</th><th>今日涨跌</th><th>持仓状态</th></tr></thead><tbody><tr><td>科创创业板 ETF</td><td>+0.4%</td><td>浮亏中</td></tr><tr><td>亚太精选 QDII</td><td>+2.3%*</td><td>小赚</td></tr><tr><td>沪港深黄金主题</td><td>-0.7%</td><td>亏损中</td></tr></tbody></table><p>*QDII 基金净值更新略有延迟</p><hr><h2 id="今日思考"><a href="#今日思考" class="headerlink" title="今日思考"></a>今日思考</h2><h3 id="1-关于止盈策略的调整"><a href="#1-关于止盈策略的调整" class="headerlink" title="1. 关于止盈策略的调整"></a>1. 关于止盈策略的调整</h3><p>原本设定的目标是「涨 20% 卖 1&#x2F;4」，但目前看来这个目标在震荡市中很难达成。</p><p><strong>新的策略思考</strong>：</p><ul><li>改为 <strong>5-10% 分批止盈</strong> 更为现实</li><li>涨多了就卖点，落袋为安</li><li>不要贪心，赚 5% 也是赚</li></ul><h3 id="2-关于亏损基金的补仓问题"><a href="#2-关于亏损基金的补仓问题" class="headerlink" title="2. 关于亏损基金的补仓问题"></a>2. 关于亏损基金的补仓问题</h3><p>某只基金目前亏损约 10%，需要上涨 11% 才能回本。</p><p><strong>决定</strong>：再观望一个月再做决定</p><ul><li>基金本身持仓方向没问题（黄金 + 科技）</li><li>短期不确定因素较多（春节、特朗普政策等）</li><li>资金压力不大，可以慢慢等</li></ul><h3 id="3-关于节前风险"><a href="#3-关于节前风险" class="headerlink" title="3. 关于节前风险"></a>3. 关于节前风险</h3><p>担心过年回来大跌，这是人之常情。</p><p><strong>应对思路</strong>：</p><ul><li>先观望，看明天走势再决定</li><li>节前最后几个交易日随时可以调整</li><li>减仓 or 持仓，取决于个人风险承受能力</li></ul><hr><h2 id="基金状态总结"><a href="#基金状态总结" class="headerlink" title="基金状态总结"></a>基金状态总结</h2><table><thead><tr><th>类型</th><th>当前状态</th><th>后续操作</th></tr></thead><tbody><tr><td>科创创业板</td><td>回血中，继续观察</td><td>涨多了可以卖点</td></tr><tr><td>亚太精选</td><td>小赚，稳健</td><td>明天看走势决定是否止盈</td></tr><tr><td>沪港深黄金</td><td>亏损，躺平</td><td>观望一个月</td></tr></tbody></table><hr><h2 id="投资感悟"><a href="#投资感悟" class="headerlink" title="投资感悟"></a>投资感悟</h2><ol><li><strong>择时很难</strong>：不要试图精准踩点</li><li><strong>落袋为安</strong>：涨了就是赚了，不要太贪</li><li><strong>长期持有</strong>：优质基金拿住，时间会给出答案</li><li><strong>复盘很重要</strong>：记录每日思考，帮助改进策略</li></ol><hr><p><em>持续更新中…</em></p><hr><p><strong>相关文章</strong>：</p><ul><li><a href="/2026/02/11/2026-02-11-fund-daily-review/">投资日记 · 2026年2月11日：技术分析实战与春节策略</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>投资复盘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>投资日记</tag>
      
      <tag>止盈策略</tag>
      
      <tag>投资思考</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenClaw Memory Search 配置优化 - 本地 Embedding 方案</title>
    <link href="/2026/02/10/OpenClaw-Memory-Search-%E6%9C%AC%E5%9C%B0Embedding%E9%85%8D%E7%BD%AE/"/>
    <url>/2026/02/10/OpenClaw-Memory-Search-%E6%9C%AC%E5%9C%B0Embedding%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在使用 OpenClaw 作为日常助手时，Memory Search（记忆检索）是一个核心功能。近期在配置过程中遇到了一些问题，记录一下解决方案。</p><h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><h3 id="1-QMD-Backend-超时"><a href="#1-QMD-Backend-超时" class="headerlink" title="1. QMD Backend 超时"></a>1. QMD Backend 超时</h3><p>OpenClaw 支持使用 <a href="https://github.com/tobi/qmd">QMD</a> 作为记忆后端，但在 VPS 环境中遇到性能问题：</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs erlang">qmd <span class="hljs-keyword">query</span> ... timed out <span class="hljs-keyword">after</span> <span class="hljs-number">4000</span>ms<br></code></pre></td></tr></table></figure><p><strong>原因分析</strong>：</p><ul><li>QMD 每次执行都重新加载模型（冷启动）</li><li>模型文件总计 2.1GB：<ul><li>embeddinggemma-300M: 314MB</li><li>qwen3-reranker-0.6b: 610MB</li><li>qmd-query-expansion-1.7B: 1.2GB</li></ul></li></ul><h3 id="2-memory-search-工具报错"><a href="#2-memory-search-工具报错" class="headerlink" title="2. memory_search 工具报错"></a>2. memory_search 工具报错</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">No</span> API key <span class="hljs-built_in">found</span> <span class="hljs-keyword">for</span> provider &quot;openai&quot;<br>memory_search tool disabled<br></code></pre></td></tr></table></figure><p>尝试使用 memory_search 工具时，系统要求配置 OpenAI API Key，但实际上我希望能用本地方案。</p><h2 id="解决方案：本地-Embedding"><a href="#解决方案：本地-Embedding" class="headerlink" title="解决方案：本地 Embedding"></a>解决方案：本地 Embedding</h2><p>查阅 <a href="https://docs.openclaw.ai/concepts/memory">OpenClaw 官方文档</a> 后，发现可以配置 <code>memorySearch.provider = &quot;local&quot;</code> 使用本地 embedding 模型。</p><h3 id="最终配置"><a href="#最终配置" class="headerlink" title="最终配置"></a>最终配置</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;agents&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;defaults&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;memorySearch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;provider&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;local&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;local&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;modelPath&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hf:ggml-org/embeddinggemma-300M-GGUF/embeddinggemma-300M-Q8_0.gguf&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;fallback&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;none&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;query&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;hybrid&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;vectorWeight&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.7</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;textWeight&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.3</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;candidateMultiplier&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><br>          <span class="hljs-punctuation">&#125;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;cache&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>          <span class="hljs-attr">&quot;maxEntries&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">50000</span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h3><table><thead><tr><th>配置项</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><code>provider</code></td><td><code>local</code></td><td>使用本地 embedding</td></tr><tr><td><code>modelPath</code></td><td>embeddinggemma-300M</td><td>本地 GGUF 模型</td></tr><tr><td><code>hybrid.enabled</code></td><td><code>true</code></td><td>启用混合检索</td></tr><tr><td><code>vectorWeight</code></td><td><code>0.7</code></td><td>向量检索权重 70%</td></tr><tr><td><code>textWeight</code></td><td><code>0.3</code></td><td>文本检索权重 30%</td></tr><tr><td><code>cache.enabled</code></td><td><code>true</code></td><td>启用缓存</td></tr><tr><td><code>maxEntries</code></td><td><code>50000</code></td><td>最大缓存条目</td></tr></tbody></table><h2 id="混合检索原理"><a href="#混合检索原理" class="headerlink" title="混合检索原理"></a>混合检索原理</h2><h3 id="向量检索（Vector-Search）"><a href="#向量检索（Vector-Search）" class="headerlink" title="向量检索（Vector Search）"></a>向量检索（Vector Search）</h3><ul><li>使用语义相似度匹配</li><li>找到意思相近但用词不同的内容</li><li>例如：搜索”基金”能找到”持仓”</li></ul><h3 id="文本检索（BM25）"><a href="#文本检索（BM25）" class="headerlink" title="文本检索（BM25）"></a>文本检索（BM25）</h3><ul><li>关键词精确匹配</li><li>适合匹配代码、ID 等</li><li>例如：搜索”012895”能找到基金代码</li></ul><h3 id="融合策略"><a href="#融合策略" class="headerlink" title="融合策略"></a>融合策略</h3><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">最终分数 </span>=<span class="hljs-string"> 0.7 × 向量分数 + 0.3 × 文本分数</span><br></code></pre></td></tr></table></figure><h2 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 搜索&quot;基金 持仓&quot;</span><br>$ memory_search(<span class="hljs-string">&quot;基金 持仓&quot;</span>)<br><br>结果：<br>1. memory/2026-02-05.md (39%) - 基金组合状态表<br>2. MEMORY.md (38%) - 长期记忆-持仓基金<br></code></pre></td></tr></table></figure><h2 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h2><ol><li><strong>完全免费</strong> - 不需要 OpenAI&#x2F;Voyage&#x2F;Gemini API Key</li><li><strong>隐私安全</strong> - 所有数据本地处理</li><li><strong>响应快速</strong> - 首次加载后有缓存</li><li><strong>混合检索</strong> - 结合语义和关键词匹配</li></ol><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>模型文件已缓存：<code>~/.node-llama-cpp/models/hf_ggml-org_embeddinggemma-300M-Q8_0.gguf</code></li><li>QMD Backend 暂时保留配置（等待官方修复冷启动问题）</li><li>memory_search 会自动回退到本地 embedding</li></ul><h2 id="相关-Issue"><a href="#相关-Issue" class="headerlink" title="相关 Issue"></a>相关 Issue</h2><ul><li><a href="https://github.com/openclaw/openclaw/issues/12752">QMD query command is slow due to model cold start</a></li><li><a href="https://github.com/openclaw/openclaw/issues/11308">QMD Memory Backend: Systemic Issues Requiring Comprehensive Fix</a></li></ul><h2 id="更新日志"><a href="#更新日志" class="headerlink" title="更新日志"></a>更新日志</h2><ul><li><strong>2026-02-10</strong>: 完成本地 embedding 配置</li></ul>]]></content>
    
    
    <categories>
      
      <category>技术笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OpenClaw</tag>
      
      <tag>QMD</tag>
      
      <tag>Memory Search</tag>
      
      <tag>Local Embedding</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python 基金趋势分析与信号生成实战</title>
    <link href="/2026/02/06/fund-analysis-python/"/>
    <url>/2026/02/06/fund-analysis-python/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文分享如何用 Python 实现基金的<strong>趋势分析</strong>和<strong>信号生成</strong>，涵盖 MA、MACD、最大回撤、夏普比率等核心指标。</p></blockquote><hr><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>用 Python 实现基金分析，可以帮助我们：</p><ul><li><strong>量化判断</strong>：用数据而非感觉做决策</li><li><strong>自动监控</strong>：定时分析，不用天天盯盘</li><li><strong>信号提示</strong>：及时发现买卖点</li></ul><p>本文将实现：</p><ol><li>移动平均线（MA）计算</li><li>MACD 指标实现</li><li>最大回撤、波动率等风险指标</li><li>综合信号生成</li></ol><hr><h2 id="一、数据获取"><a href="#一、数据获取" class="headerlink" title="一、数据获取"></a>一、数据获取</h2><p>使用东方财富 API 获取基金历史净值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_fund_history</span>(<span class="hljs-params">fund_code: <span class="hljs-built_in">str</span>, days: <span class="hljs-built_in">int</span> = <span class="hljs-number">60</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:<br>    <span class="hljs-string">&quot;&quot;&quot;获取基金历史净值&quot;&quot;&quot;</span><br>    url = <span class="hljs-string">&quot;http://api.fund.eastmoney.com/f10/lsjz&quot;</span><br>    end_date = datetime.now().strftime(<span class="hljs-string">&quot;%Y-%m-%d&quot;</span>)<br>    start_date = (datetime.now() - timedelta(days=days+<span class="hljs-number">30</span>)).strftime(<span class="hljs-string">&quot;%Y-%m-%d&quot;</span>)<br>    <br>    params = &#123;<br>        <span class="hljs-string">&quot;fundCode&quot;</span>: fund_code,<br>        <span class="hljs-string">&quot;pageIndex&quot;</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-string">&quot;pageSize&quot;</span>: days,<br>        <span class="hljs-string">&quot;startDate&quot;</span>: start_date,<br>        <span class="hljs-string">&quot;endDate&quot;</span>: end_date,<br>        <span class="hljs-string">&quot;_&quot;</span>: <span class="hljs-built_in">int</span>(time.time() * <span class="hljs-number">1000</span>)<br>    &#125;<br>    headers = &#123;<span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0&quot;</span>&#125;<br>    <br>    <span class="hljs-keyword">try</span>:<br>        r = requests.get(url, params=params, headers=headers, timeout=<span class="hljs-number">15</span>)<br>        <span class="hljs-keyword">if</span> r.status_code == <span class="hljs-number">200</span>:<br>            data = r.json()<br>            <span class="hljs-keyword">if</span> data.get(<span class="hljs-string">&quot;Data&quot;</span>):<br>                records = data[<span class="hljs-string">&quot;Data&quot;</span>].get(<span class="hljs-string">&quot;LSJZ&quot;</span>, [])<br>                <span class="hljs-keyword">return</span> [&#123;<br>                    <span class="hljs-string">&quot;date&quot;</span>: r[<span class="hljs-string">&quot;FSRQ&quot;</span>],<br>                    <span class="hljs-string">&quot;nav&quot;</span>: <span class="hljs-built_in">float</span>(r[<span class="hljs-string">&quot;DWJZ&quot;</span>]),<br>                    <span class="hljs-string">&quot;change&quot;</span>: <span class="hljs-built_in">float</span>(r[<span class="hljs-string">&quot;JZZZL&quot;</span>])<br>                &#125; <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> records]<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Error: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> []<br></code></pre></td></tr></table></figure><hr><h2 id="二、MA-移动平均线"><a href="#二、MA-移动平均线" class="headerlink" title="二、MA 移动平均线"></a>二、MA 移动平均线</h2><h3 id="2-1-简单移动平均（SMA）"><a href="#2-1-简单移动平均（SMA）" class="headerlink" title="2.1 简单移动平均（SMA）"></a>2.1 简单移动平均（SMA）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_ma</span>(<span class="hljs-params">data: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>], period: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">float</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;计算简单移动平均&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) &lt; period:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(data) / <span class="hljs-built_in">len</span>(data) <span class="hljs-keyword">if</span> data <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(data[-period:]) / period<br></code></pre></td></tr></table></figure><table><thead><tr><th>周期</th><th>用途</th><th>敏感度</th></tr></thead><tbody><tr><td>MA5</td><td>短期趋势</td><td>高</td></tr><tr><td>MA20</td><td>中期趋势</td><td>中</td></tr><tr><td>MA60</td><td>长期趋势</td><td>低</td></tr></tbody></table><h3 id="2-2-指数移动平均（EMA）"><a href="#2-2-指数移动平均（EMA）" class="headerlink" title="2.2 指数移动平均（EMA）"></a>2.2 指数移动平均（EMA）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_ema</span>(<span class="hljs-params">data: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>], period: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">float</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;计算指数移动平均（近期权重更高）&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) &lt; period:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(data) / <span class="hljs-built_in">len</span>(data) <span class="hljs-keyword">if</span> data <span class="hljs-keyword">else</span> <span class="hljs-number">0</span><br>    <br>    multiplier = <span class="hljs-number">2</span> / (period + <span class="hljs-number">1</span>)<br>    ema = data[<span class="hljs-number">0</span>]<br>    <span class="hljs-keyword">for</span> price <span class="hljs-keyword">in</span> data[<span class="hljs-number">1</span>:]:<br>        ema = price * multiplier + ema * (<span class="hljs-number">1</span> - multiplier)<br>    <span class="hljs-keyword">return</span> ema<br></code></pre></td></tr></table></figure><h3 id="2-3-MA-交叉信号"><a href="#2-3-MA-交叉信号" class="headerlink" title="2.3 MA 交叉信号"></a>2.3 MA 交叉信号</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">detect_ma_crossover</span>(<span class="hljs-params">ma5: <span class="hljs-built_in">float</span>, ma20: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;检测 MA 交叉信号&quot;&quot;&quot;</span><br>    diff = ma5 - ma20<br>    <span class="hljs-keyword">if</span> diff &gt; <span class="hljs-number">0.01</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;GOLDEN_CROSS&quot;</span>  <span class="hljs-comment"># 金叉，看涨</span><br>    <span class="hljs-keyword">elif</span> diff &lt; -<span class="hljs-number">0.01</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;DEATH_CROSS&quot;</span>   <span class="hljs-comment"># 死叉，看跌</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;NEUTRAL&quot;</span><br></code></pre></td></tr></table></figure><hr><h2 id="三、MACD-指标"><a href="#三、MACD-指标" class="headerlink" title="三、MACD 指标"></a>三、MACD 指标</h2><h3 id="3-1-公式"><a href="#3-1-公式" class="headerlink" title="3.1 公式"></a>3.1 公式</h3><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">DIF</span> <span class="hljs-operator">=</span> EMA12 - EMA26<br><span class="hljs-attribute">DEA</span> <span class="hljs-operator">=</span> EMA9(DIF)<br><span class="hljs-attribute">Histogram</span> <span class="hljs-operator">=</span> (DIF - DEA) × <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h3 id="3-2-Python-实现"><a href="#3-2-Python-实现" class="headerlink" title="3.2 Python 实现"></a>3.2 Python 实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_macd</span>(<span class="hljs-params">data: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>]</span>) -&gt; <span class="hljs-type">Tuple</span>[<span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>, <span class="hljs-built_in">float</span>]:<br>    <span class="hljs-string">&quot;&quot;&quot;计算 MACD&quot;&quot;&quot;</span><br>    ema12 = calculate_ema(data, <span class="hljs-number">12</span>)<br>    ema26 = calculate_ema(data, <span class="hljs-number">26</span>)<br>    <br>    dif = ema12 - ema26<br>    dea = calculate_ema([dif], <span class="hljs-number">9</span>)  <span class="hljs-comment"># DIF 的 EMA</span><br>    hist = (dif - dea) * <span class="hljs-number">2</span><br>    <br>    <span class="hljs-keyword">return</span> dif, dea, hist<br></code></pre></td></tr></table></figure><h3 id="3-3-信号解读"><a href="#3-3-信号解读" class="headerlink" title="3.3 信号解读"></a>3.3 信号解读</h3><table><thead><tr><th>状态</th><th>DIF vs DEA</th><th>Histogram</th><th>信号</th></tr></thead><tbody><tr><td>多头</td><td>DIF &gt; DEA</td><td>&gt; 0</td><td>看涨</td></tr><tr><td>震荡</td><td>DIF ≈ DEA</td><td>≈ 0</td><td>观望</td></tr><tr><td>空头</td><td>DIF &lt; DEA</td><td>&lt; 0</td><td>看跌</td></tr></tbody></table><hr><h2 id="四、风险指标"><a href="#四、风险指标" class="headerlink" title="四、风险指标"></a>四、风险指标</h2><h3 id="4-1-最大回撤"><a href="#4-1-最大回撤" class="headerlink" title="4.1 最大回撤"></a>4.1 最大回撤</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_max_drawdown</span>(<span class="hljs-params">data: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>]</span>) -&gt; <span class="hljs-built_in">float</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;计算最大回撤百分比&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <br>    max_nav = <span class="hljs-number">0</span><br>    max_dd = <span class="hljs-number">0</span><br>    <br>    <span class="hljs-keyword">for</span> nav <span class="hljs-keyword">in</span> data:<br>        <span class="hljs-keyword">if</span> nav &gt; max_nav:<br>            max_nav = nav<br>        dd = (max_nav - nav) / max_nav * <span class="hljs-number">100</span><br>        <span class="hljs-keyword">if</span> dd &gt; max_dd:<br>            max_dd = dd<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">round</span>(max_dd, <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><table><thead><tr><th>回撤</th><th>风险等级</th></tr></thead><tbody><tr><td>&lt; 5%</td><td>低风险</td></tr><tr><td>5-15%</td><td>中风险</td></tr><tr><td>&gt; 15%</td><td>高风险</td></tr></tbody></table><h3 id="4-2-波动率"><a href="#4-2-波动率" class="headerlink" title="4.2 波动率"></a>4.2 波动率</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> statistics<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_volatility</span>(<span class="hljs-params">data: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>]</span>) -&gt; <span class="hljs-built_in">float</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;计算年化波动率（百分比）&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) &lt; <span class="hljs-number">2</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <br>    changes = [d <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> data[<span class="hljs-number">1</span>:]]<br>    std = statistics.stdev(changes)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">round</span>(std * math.sqrt(<span class="hljs-number">252</span>) * <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><h3 id="4-3-夏普比率"><a href="#4-3-夏普比率" class="headerlink" title="4.3 夏普比率"></a>4.3 夏普比率</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_sharpe</span>(<span class="hljs-params">data: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>], volatility: <span class="hljs-built_in">float</span>, risk_free: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.03</span></span>) -&gt; <span class="hljs-built_in">float</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;计算夏普比率&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data <span class="hljs-keyword">or</span> volatility == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <br>    total_return = (data[-<span class="hljs-number">1</span>] - data[<span class="hljs-number">0</span>]) / data[<span class="hljs-number">0</span>]<br>    annualized = total_return * (<span class="hljs-number">252</span> / <span class="hljs-built_in">len</span>(data))<br>    sharpe = (annualized - risk_free) / (volatility / <span class="hljs-number">100</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">round</span>(sharpe, <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><table><thead><tr><th>夏普比率</th><th>评价</th></tr></thead><tbody><tr><td>&gt; 2.0</td><td>优秀</td></tr><tr><td>1.5-2.0</td><td>良好</td></tr><tr><td>1.0-1.5</td><td>一般</td></tr><tr><td>&lt; 1.0</td><td>较差</td></tr></tbody></table><hr><h2 id="五、综合信号"><a href="#五、综合信号" class="headerlink" title="五、综合信号"></a>五、综合信号</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_trend_status</span>(<span class="hljs-params">ma5: <span class="hljs-built_in">float</span>, ma20: <span class="hljs-built_in">float</span>, ma60: <span class="hljs-built_in">float</span>, macd_hist: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;综合判断趋势&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> ma5 &gt; ma20 &gt; ma60 <span class="hljs-keyword">and</span> macd_hist &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;🟢 STRONG_UP&quot;</span>   <span class="hljs-comment"># 强势上涨</span><br>    <span class="hljs-keyword">elif</span> ma5 &gt; ma20 <span class="hljs-keyword">and</span> macd_hist &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;🟡 UP&quot;</span>           <span class="hljs-comment"># 温和上涨</span><br>    <span class="hljs-keyword">elif</span> ma5 &lt; ma20 <span class="hljs-keyword">and</span> macd_hist &lt; <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;🔴 DOWN&quot;</span>         <span class="hljs-comment"># 下跌趋势</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;🟠 CONSOLIDATE&quot;</span>  <span class="hljs-comment"># 震荡整理</span><br></code></pre></td></tr></table></figure><hr><h2 id="六、完整示例"><a href="#六、完整示例" class="headerlink" title="六、完整示例"></a>六、完整示例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_fund</span>(<span class="hljs-params">code: <span class="hljs-built_in">str</span>, nav_data: <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]</span>) -&gt; <span class="hljs-type">Dict</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;完整基金分析&quot;&quot;&quot;</span><br>    navs = [item[<span class="hljs-string">&quot;nav&quot;</span>] <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> nav_data]<br>    <br>    ma5 = calculate_ma(navs, <span class="hljs-number">5</span>)<br>    ma20 = calculate_ma(navs, <span class="hljs-number">20</span>)<br>    ma60 = calculate_ma(navs, <span class="hljs-number">60</span>)<br>    dif, dea, hist = calculate_macd(navs)<br>    <br>    max_dd = calculate_max_drawdown(navs)<br>    volatility = calculate_volatility(navs)<br>    sharpe = calculate_sharpe(navs, volatility)<br>    <br>    trend = get_trend_status(ma5, ma20, ma60, hist)<br>    <br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;code&quot;</span>: code,<br>        <span class="hljs-string">&quot;trend&quot;</span>: trend,<br>        <span class="hljs-string">&quot;ma&quot;</span>: &#123;<span class="hljs-string">&quot;ma5&quot;</span>: ma5, <span class="hljs-string">&quot;ma20&quot;</span>: ma20, <span class="hljs-string">&quot;ma60&quot;</span>: ma60&#125;,<br>        <span class="hljs-string">&quot;macd&quot;</span>: &#123;<span class="hljs-string">&quot;dif&quot;</span>: dif, <span class="hljs-string">&quot;dea&quot;</span>: dea, <span class="hljs-string">&quot;hist&quot;</span>: hist&#125;,<br>        <span class="hljs-string">&quot;risk&quot;</span>: &#123;<span class="hljs-string">&quot;max_drawdown&quot;</span>: max_dd, <span class="hljs-string">&quot;volatility&quot;</span>: volatility, <span class="hljs-string">&quot;sharpe&quot;</span>: sharpe&#125;,<br>    &#125;<br></code></pre></td></tr></table></figure><hr><h2 id="七、输出示例"><a href="#七、输出示例" class="headerlink" title="七、输出示例"></a>七、输出示例</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros">🔹 某ETF基金 [指数型]<br>━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━<br>📈 Trend: 🟡 UP<br>📊 MA: <span class="hljs-attribute">MA5</span>=1.025, <span class="hljs-attribute">MA20</span>=1.038, <span class="hljs-attribute">MA60</span>=1.045<br>📉 MACD: <span class="hljs-attribute">DIF</span>=+0.0012, <span class="hljs-attribute">Hist</span>=+0.0004<br><br>📊 Risk Metrics:<br>   Max Drawdown: 3.2% (🟢 LOW)<br>   Volatility: 1.8% (🟡 MEDIUM)<br>   Sharpe: 1.24<br><br>💡 Signal: HOLD<br></code></pre></td></tr></table></figure><hr><h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><table><thead><tr><th>指标</th><th>作用</th><th>敏感度</th></tr></thead><tbody><tr><td>MA5&#x2F;MA20</td><td>短期趋势</td><td>高</td></tr><tr><td>MACD</td><td>动能判断</td><td>中</td></tr><tr><td>MaxDD</td><td>风险控制</td><td>-</td></tr><tr><td>Sharpe</td><td>风险收益比</td><td>-</td></tr></tbody></table><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol><li><strong>历史不代表未来</strong>：指标基于历史数据</li><li><strong>综合判断</strong>：单一指标可能有假信号</li><li><strong>设置止损</strong>：即使趋势良好也要控制风险</li></ol><hr><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>完整脚本：<code>/root/.openclaw/skills/fund-analysis/scripts/</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 运行分析</span><br>python3 fund_analysis_enhanced.py<br><br><span class="hljs-comment"># 依赖</span><br>pip install requests statistics<br></code></pre></td></tr></table></figure><hr><p><em>技术笔记 · 持续更新</em></p>]]></content>
    
    
    <categories>
      
      <category>技术笔记</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MA</tag>
      
      <tag>MACD</tag>
      
      <tag>技术指标</tag>
      
      <tag>Python</tag>
      
      <tag>基金分析</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Serper.dev 免费 Google 搜索 API 使用指南</title>
    <link href="/2026/02/06/serper-api-guide/"/>
    <url>/2026/02/06/serper-api-guide/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文首发于 2026-02-06</p></blockquote><h2 id="为什么需要-Serper？"><a href="#为什么需要-Serper？" class="headerlink" title="为什么需要 Serper？"></a>为什么需要 Serper？</h2><p>在开发 AI 助手或自动化脚本时，经常需要获取搜索引擎结果。常见的方案有：</p><table><thead><tr><th>服务</th><th>特点</th><th>限制</th></tr></thead><tbody><tr><td>Google Custom Search</td><td>官方但复杂</td><td>需要配置 Search Console</td></tr><tr><td>Brave Search</td><td>新兴选择</td><td>免费额度有限</td></tr><tr><td><strong>Serper.dev</strong></td><td>Google 结果，<strong>免费 2500 次</strong></td><td>额度用完后收费</td></tr></tbody></table><p>对于个人项目或小规模使用，<strong>Serper 2500 次免费额度足够用很久</strong>。</p><hr><h2 id="Serper-简介"><a href="#Serper-简介" class="headerlink" title="Serper 简介"></a>Serper 简介</h2><p>Serper.dev 是一个提供 Google 搜索结果 API 的服务：</p><ul><li>✅ 无需信用卡，<strong>免费 2500 次查询</strong></li><li>✅ 返回结构化 JSON</li><li>✅ 支持搜索、图片、新闻、地点、自动补全</li><li>✅ 响应速度快</li></ul><h3 id="免费额度"><a href="#免费额度" class="headerlink" title="免费额度"></a>免费额度</h3><table><thead><tr><th>套餐</th><th>价格</th><th>额度</th></tr></thead><tbody><tr><td>Free</td><td><strong>免费</strong></td><td>2,500 次</td></tr><tr><td>Pro</td><td>$50&#x2F;月</td><td>10,000 次</td></tr></tbody></table><hr><h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2><h3 id="1-获取-API-Key"><a href="#1-获取-API-Key" class="headerlink" title="1. 获取 API Key"></a>1. 获取 API Key</h3><p>访问 <a href="https://serper.dev/">https://serper.dev</a> 注册账号，免费获取 API Key。</p><h3 id="2-基础用法（cURL）"><a href="#2-基础用法（cURL）" class="headerlink" title="2. 基础用法（cURL）"></a>2. 基础用法（cURL）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 设置 API Key</span><br><span class="hljs-built_in">export</span> SERPER_API_KEY=<span class="hljs-string">&quot;你的API密钥&quot;</span><br><br><span class="hljs-comment"># 网页搜索</span><br>curl <span class="hljs-string">&quot;https://google.serper.dev/search?q=OpenClaw&quot;</span> \<br>  -H <span class="hljs-string">&quot;X-API-Key: <span class="hljs-variable">$SERPER_API_KEY</span>&quot;</span><br></code></pre></td></tr></table></figure><h3 id="3-响应示例"><a href="#3-响应示例" class="headerlink" title="3. 响应示例"></a>3. 响应示例</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;searchParameters&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;q&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;OpenClaw&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;search&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;engine&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;google&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;organic&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;title&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;OpenClaw - AI Assistant&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://github.com/openclaw/openclaw&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;snippet&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;OpenClaw is an AI assistant that runs on your machine...&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;domain&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;github.com&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;position&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;credits&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><hr><h2 id="Python-示例"><a href="#Python-示例" class="headerlink" title="Python 示例"></a>Python 示例</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>SERPER_API_KEY = <span class="hljs-string">&quot;你的API密钥&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">query, num=<span class="hljs-number">10</span></span>):<br>    url = <span class="hljs-string">&quot;https://google.serper.dev/search&quot;</span><br>    params = &#123;<span class="hljs-string">&quot;q&quot;</span>: query, <span class="hljs-string">&quot;num&quot;</span>: num&#125;<br>    headers = &#123;<span class="hljs-string">&quot;X-API-Key&quot;</span>: SERPER_API_KEY&#125;<br>    <br>    response = requests.get(url, params=params, headers=headers)<br>    <span class="hljs-keyword">return</span> response.json()<br><br><span class="hljs-comment"># 使用</span><br>results = search(<span class="hljs-string">&quot;基金行情 今日&quot;</span>)<br><span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> results[<span class="hljs-string">&quot;organic&quot;</span>]:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;r[<span class="hljs-string">&#x27;position&#x27;</span>]&#125;</span>. <span class="hljs-subst">&#123;r[<span class="hljs-string">&#x27;title&#x27;</span>]&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   <span class="hljs-subst">&#123;r[<span class="hljs-string">&#x27;url&#x27;</span>]&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><hr><h2 id="进阶：支持多种搜索类型"><a href="#进阶：支持多种搜索类型" class="headerlink" title="进阶：支持多种搜索类型"></a>进阶：支持多种搜索类型</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br>SERPER_API_KEY = <span class="hljs-string">&quot;你的API密钥&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">serper_search</span>(<span class="hljs-params">query, search_type=<span class="hljs-string">&quot;search&quot;</span>, num=<span class="hljs-number">10</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;通用搜索接口&quot;&quot;&quot;</span><br>    endpoints = &#123;<br>        <span class="hljs-string">&quot;search&quot;</span>: <span class="hljs-string">&quot;https://google.serper.dev/search&quot;</span>,<br>        <span class="hljs-string">&quot;images&quot;</span>: <span class="hljs-string">&quot;https://google.serper.dev/images&quot;</span>,<br>        <span class="hljs-string">&quot;news&quot;</span>: <span class="hljs-string">&quot;https://google.serper.dev/news&quot;</span>,<br>        <span class="hljs-string">&quot;places&quot;</span>: <span class="hljs-string">&quot;https://google.serper.dev/places&quot;</span>,<br>        <span class="hljs-string">&quot;autocomplete&quot;</span>: <span class="hljs-string">&quot;https://google.serper.dev/autocomplete&quot;</span><br>    &#125;<br>    <br>    url = endpoints.get(search_type, endpoints[<span class="hljs-string">&quot;search&quot;</span>])<br>    params = &#123;<span class="hljs-string">&quot;q&quot;</span>: query, <span class="hljs-string">&quot;num&quot;</span>: num&#125;<br>    headers = &#123;<span class="hljs-string">&quot;X-API-Key&quot;</span>: SERPER_API_KEY&#125;<br>    <br>    <span class="hljs-keyword">return</span> requests.get(url, params=params, headers=headers).json()<br><br><span class="hljs-comment"># 使用</span><br>images = serper_search(<span class="hljs-string">&quot;可爱猫咪&quot;</span>, search_type=<span class="hljs-string">&quot;images&quot;</span>, num=<span class="hljs-number">5</span>)<br>news = serper_search(<span class="hljs-string">&quot;AI 新闻&quot;</span>, search_type=<span class="hljs-string">&quot;news&quot;</span>, num=<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><hr><h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h2><table><thead><tr><th>参数</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>q</code></td><td>搜索关键词</td><td>必填</td></tr><tr><td><code>gl</code></td><td>国家代码</td><td>US</td></tr><tr><td><code>hl</code></td><td>语言代码</td><td>en</td></tr><tr><td><code>num</code></td><td>返回数量</td><td>10</td></tr><tr><td><code>safe</code></td><td>安全搜索</td><td>on</td></tr></tbody></table><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl <span class="hljs-string">&quot;https://google.serper.dev/search?q=Python&amp;gl=US&amp;hl=en&amp;num=5&quot;</span> \<br>  -H <span class="hljs-string">&quot;X-API-Key: <span class="hljs-variable">$SERPER_API_KEY</span>&quot;</span><br></code></pre></td></tr></table></figure><hr><h2 id="在-OpenClaw-中使用"><a href="#在-OpenClaw-中使用" class="headerlink" title="在 OpenClaw 中使用"></a>在 OpenClaw 中使用</h2><p>OpenClaw 是一个本地运行的 AI 助手，可以通过以下方式集成 Serper：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 1. 设置环境变量</span><br><span class="hljs-built_in">export</span> SERPER_API_KEY=<span class="hljs-string">&quot;你的API密钥&quot;</span><br><br><span class="hljs-comment"># 2. 使用 serper skill 进行搜索</span><br>/root/.openclaw/skills/serper/scripts/search.sh <span class="hljs-string">&quot;今日基金行情&quot;</span><br></code></pre></td></tr></table></figure><hr><h2 id="替代方案对比"><a href="#替代方案对比" class="headerlink" title="替代方案对比"></a>替代方案对比</h2><table><thead><tr><th>服务</th><th>免费额度</th><th>特点</th></tr></thead><tbody><tr><td><strong>Serper</strong></td><td>2,500 次</td><td>Google 结果准</td></tr><tr><td>DuckDuckGo API</td><td>无限</td><td>完全免费但结果一般</td></tr><tr><td>Brave Search</td><td>有限</td><td>需要申请</td></tr><tr><td><strong>LangSearch</strong></td><td>无限</td><td>免费，支持 Rerank</td></tr></tbody></table><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Serper.dev 是一个适合个人开发者和小型项目的搜索 API：</p><ol><li><strong>免费 2500 次</strong>，无需信用卡</li><li><strong>Google 质量</strong>，结果准确</li><li><strong>使用简单</strong>，返回 JSON</li><li><strong>响应快速</strong>，适合实时应用</li></ol><p>对于大多数个人项目来说，2500 次免费额度已经足够用很久了。即使用完，升级到付费版（$50&#x2F;月）也比自建爬虫省心。</p><hr><p><strong>参考链接：</strong></p><ul><li>官网：<a href="https://serper.dev/">https://serper.dev</a></li><li>文档：<a href="https://serper.dev/docs">https://serper.dev/docs</a></li><li>注册：<a href="https://serper.dev/signup">https://serper.dev/signup</a></li></ul><hr><p><em>欢迎在评论区分享你的使用经验！</em></p>]]></content>
    
    
    <categories>
      
      <category>技术</category>
      
    </categories>
    
    
    <tags>
      
      <tag>API</tag>
      
      <tag>Google</tag>
      
      <tag>搜索</tag>
      
      <tag>开发工具</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenClaw 概览与核心功能 - 你的 AI 助手网关</title>
    <link href="/2026/02/06/OpenClaw-%E6%A6%82%E8%A7%88%E4%B8%8E%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/"/>
    <url>/2026/02/06/OpenClaw-%E6%A6%82%E8%A7%88%E4%B8%8E%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/</url>
    
    <content type="html"><![CDATA[<h1 id="OpenClaw-概览与核心功能-你的-AI-助手网关"><a href="#OpenClaw-概览与核心功能-你的-AI-助手网关" class="headerlink" title="OpenClaw 概览与核心功能 - 你的 AI 助手网关"></a>OpenClaw 概览与核心功能 - 你的 AI 助手网关</h1><h2 id="什么是-OpenClaw？"><a href="#什么是-OpenClaw？" class="headerlink" title="什么是 OpenClaw？"></a>什么是 OpenClaw？</h2><p>OpenClaw 是一个<strong>开源的 AI 助手网关</strong>，连接聊天平台与 AI Agent。</p><h3 id="核心理念"><a href="#核心理念" class="headerlink" title="核心理念"></a>核心理念</h3><ul><li>🤖 <strong>多平台支持</strong>：Telegram、WhatsApp、Discord、iMessage 等</li><li>🧠 <strong>Agent 能力</strong>：集成 Claude Code、Pi 等编程 Agent</li><li>🔌 <strong>Skills 扩展</strong>：通过 Skills 扩展功能</li><li>🔒 <strong>本地部署</strong>：数据完全掌握在自己手中</li></ul><h3 id="解决的问题"><a href="#解决的问题" class="headerlink" title="解决的问题"></a>解决的问题</h3><table><thead><tr><th>问题</th><th>OpenClaw 方案</th></tr></thead><tbody><tr><td>不方便对话</td><td>Telegram 随时随地聊天</td></tr><tr><td>记忆丢失</td><td>QMD 向量记忆系统</td></tr><tr><td>工具单一</td><td>Skills 扩展生态</td></tr><tr><td>隐私泄露</td><td>完全本地部署</td></tr></tbody></table><h2 id="架构设计"><a href="#架构设计" class="headerlink" title="架构设计"></a>架构设计</h2><h3 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">┌─────────────┐<br>│  Telegram   │<br>│  WhatsApp  │  ← 聊天平台<br>│  <span class="hljs-keyword">Discord </span>  │<br>└──────┬──────┘<br>       │<br>       ▼<br>┌─────────────┐<br>│  Gateway    │  ← 统一网关<br>└──────┬──────┘<br>       │<br>       ▼<br>┌─────────────┐<br>│   Agent     │  ← AI 能力<br>│  Skills     │<br>└──────┬──────┘<br>       │<br>       ▼<br>┌─────────────┐<br>│  Memory     │  ← 记忆系统 (QMD)<br>└─────────────┘<br></code></pre></td></tr></table></figure><h3 id="关键概念"><a href="#关键概念" class="headerlink" title="关键概念"></a>关键概念</h3><h4 id="Gateway"><a href="#Gateway" class="headerlink" title="Gateway"></a>Gateway</h4><p>网关是 OpenClaw 的核心，负责：</p><ul><li><strong>会话管理</strong>：多用户、多会话</li><li><strong>路由分发</strong>：消息路由到对应 Agent</li><li><strong>通道连接</strong>：连接各种聊天平台</li><li><strong>认证授权</strong>：Token、密码验证</li></ul><h4 id="Agent"><a href="#Agent" class="headerlink" title="Agent"></a>Agent</h4><p>Agent 提供 AI 能力：</p><table><thead><tr><th>Agent</th><th>特点</th></tr></thead><tbody><tr><td><strong>Pi</strong></td><td>友好对话，适合日常使用</td></tr><tr><td><strong>Claude Code</strong></td><td>编程能力强，适合开发者</td></tr><tr><td><strong>自定义</strong></td><td>可集成其他 LLM</td></tr></tbody></table><h4 id="Skills"><a href="#Skills" class="headerlink" title="Skills"></a>Skills</h4><p>Skills 是功能扩展：</p><table><thead><tr><th>分类</th><th>Skills</th></tr></thead><tbody><tr><td>💬 通讯</td><td>discord, slack, imsg, bird</td></tr><tr><td>🍎 Apple</td><td>apple-notes, things-mac</td></tr><tr><td>🎵 音乐</td><td>spotify-player</td></tr><tr><td>🔧 开发</td><td>github, coding-agent</td></tr><tr><td>🛠️ 工具</td><td>weather, healthcheck</td></tr></tbody></table><h2 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h2><h3 id="1-多平台集成"><a href="#1-多平台集成" class="headerlink" title="1. 多平台集成"></a>1. 多平台集成</h3><h4 id="Telegram-配置"><a href="#Telegram-配置" class="headerlink" title="Telegram 配置"></a>Telegram 配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;channels&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;telegram&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;your-bot-token&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;allowFrom&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;user-id-1&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;user-id-2&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;groups&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;*&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>          <span class="hljs-attr">&quot;requireMention&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>        <span class="hljs-punctuation">&#125;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="多账号支持"><a href="#多账号支持" class="headerlink" title="多账号支持"></a>多账号支持</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;agents&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;assistant&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;AI 助手&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;channels&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;telegram&quot;</span><span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;coder&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;编程助手&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;channels&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;discord&quot;</span><span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="2-Agent-系统"><a href="#2-Agent-系统" class="headerlink" title="2. Agent 系统"></a>2. Agent 系统</h3><h4 id="Agent-配置"><a href="#Agent-配置" class="headerlink" title="Agent 配置"></a>Agent 配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;agents&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;default&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;pi&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;list&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;pi&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;provider&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;pi&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sonnet-4-2-2025-01-21&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;coder&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;provider&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;anthropic&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;model&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;claude-code&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="MCP-集成"><a href="#MCP-集成" class="headerlink" title="MCP 集成"></a>MCP 集成</h4><p>OpenClaw 支持 MCP (Model Context Protocol)：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;mcp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;servers&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;filesystem&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;command&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npx&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;args&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;-y&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;@modelcontextprotocol/server-filesystem&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;/path&quot;</span><span class="hljs-punctuation">]</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="3-QMD-向量记忆"><a href="#3-QMD-向量记忆" class="headerlink" title="3. QMD 向量记忆"></a>3. QMD 向量记忆</h3><p>QMD 是 OpenClaw 的记忆系统：</p><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;memory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;backend&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;qmd&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;qmd&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;includeDefaultMemory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;update&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;interval&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5m&quot;</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;limits&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;maxResults&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;timeoutMs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4000</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h4><table><thead><tr><th>功能</th><th>命令</th></tr></thead><tbody><tr><td>全文搜索</td><td><code>qmd search</code></td></tr><tr><td>向量搜索</td><td><code>qmd vsearch</code></td></tr><tr><td>混合搜索</td><td><code>qmd query</code></td></tr></tbody></table><h3 id="4-Tools-工具集"><a href="#4-Tools-工具集" class="headerlink" title="4. Tools 工具集"></a>4. Tools 工具集</h3><p>OpenClaw 内置丰富的 Tools：</p><table><thead><tr><th>分类</th><th>工具</th><th>功能</th></tr></thead><tbody><tr><td>🖥️</td><td>browser</td><td>浏览器控制</td></tr><tr><td>📝</td><td>read&#x2F;write&#x2F;edit</td><td>文件操作</td></tr><tr><td>🔧</td><td>exec</td><td>命令执行</td></tr><tr><td>🔍</td><td>web_search</td><td>网络搜索</td></tr><tr><td>📊</td><td>cron</td><td>定时任务</td></tr><tr><td>🌐</td><td>nodes</td><td>节点管理</td></tr></tbody></table><h3 id="5-安全性"><a href="#5-安全性" class="headerlink" title="5. 安全性"></a>5. 安全性</h3><h4 id="认证配置"><a href="#认证配置" class="headerlink" title="认证配置"></a>认证配置</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;gateway&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;auth&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;mode&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;token&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;token&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;your-secret-token&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h4 id="工具权限"><a href="#工具权限" class="headerlink" title="工具权限"></a>工具权限</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;tools&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;allow&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;read&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;write&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;browser&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;deny&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;exec&quot;</span><span class="hljs-punctuation">]</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="部署方式"><a href="#部署方式" class="headerlink" title="部署方式"></a>部署方式</h2><h3 id="方式-1：VPS-部署（推荐）"><a href="#方式-1：VPS-部署（推荐）" class="headerlink" title="方式 1：VPS 部署（推荐）"></a>方式 1：VPS 部署（推荐）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 安装</span><br>npm install -g openclaw<br><br><span class="hljs-comment"># 启动</span><br>openclaw gateway<br><br><span class="hljs-comment"># 后台运行</span><br><span class="hljs-built_in">nohup</span> openclaw gateway &gt; /var/log/openclaw.log 2&gt;&amp;1 &amp;<br></code></pre></td></tr></table></figure><h3 id="方式-2：Docker-部署"><a href="#方式-2：Docker-部署" class="headerlink" title="方式 2：Docker 部署"></a>方式 2：Docker 部署</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># docker-compose.yml</span><br><span class="hljs-attr">version:</span> <span class="hljs-string">&#x27;3.8&#x27;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">openclaw:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">openclaw/openclaw</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">~/.openclaw:/root/.openclaw</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;18789:18789&quot;</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span><br></code></pre></td></tr></table></figure><h3 id="方式-3：源码部署"><a href="#方式-3：源码部署" class="headerlink" title="方式 3：源码部署"></a>方式 3：源码部署</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/openclaw/openclaw.git<br><span class="hljs-built_in">cd</span> openclaw<br>npm install<br>npm run build<br>node dist/entry.js gateway<br></code></pre></td></tr></table></figure><h2 id="Skills-生态"><a href="#Skills-生态" class="headerlink" title="Skills 生态"></a>Skills 生态</h2><h3 id="官方-Skills"><a href="#官方-Skills" class="headerlink" title="官方 Skills"></a>官方 Skills</h3><table><thead><tr><th>分类</th><th>Skills</th></tr></thead><tbody><tr><td>💬 通讯</td><td>discord, slack, imsg, bird</td></tr><tr><td>🔧 开发</td><td>github, coding-agent, mcporter</td></tr><tr><td>🍎 Apple</td><td>apple-notes, things-mac, bear-notes</td></tr><tr><td>🎵 媒体</td><td>spotify-player, songsee</td></tr><tr><td>🛠️ 工具</td><td>weather, healthcheck, qmd</td></tr></tbody></table><h3 id="安装-Skills"><a href="#安装-Skills" class="headerlink" title="安装 Skills"></a>安装 Skills</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 通过 OpenClaw CLI</span><br>openclaw skills install github<br><br><span class="hljs-comment"># 或手动安装</span><br><span class="hljs-built_in">cd</span> /path/to/openclaw/skills<br>git <span class="hljs-built_in">clone</span> https://github.com/tobi/qmd.git<br></code></pre></td></tr></table></figure><h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><h3 id="场景-1：个人-AI-助手"><a href="#场景-1：个人-AI-助手" class="headerlink" title="场景 1：个人 AI 助手"></a>场景 1：个人 AI 助手</h3><ul><li>Telegram 随时对话</li><li>记住你的偏好和习惯</li><li>帮你管理日程</li></ul><h3 id="场景-2：编程助手"><a href="#场景-2：编程助手" class="headerlink" title="场景 2：编程助手"></a>场景 2：编程助手</h3><ul><li>Claude Code 集成</li><li>GitHub PR Review</li><li>代码审查和优化</li></ul><h3 id="场景-3：运维工具箱"><a href="#场景-3：运维工具箱" class="headerlink" title="场景 3：运维工具箱"></a>场景 3：运维工具箱</h3><ul><li>VPS 健康检查</li><li>自动备份</li><li>定时任务</li></ul><h2 id="性能与优化"><a href="#性能与优化" class="headerlink" title="性能与优化"></a>性能与优化</h2><h3 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h3><table><thead><tr><th>配置</th><th>最低</th><th>推荐</th></tr></thead><tbody><tr><td>内存</td><td>1GB</td><td>2GB+</td></tr><tr><td>CPU</td><td>1 核</td><td>2 核</td></tr><tr><td>存储</td><td>10GB</td><td>20GB+</td></tr></tbody></table><h3 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h3><h4 id="1-Swap-配置"><a href="#1-Swap-配置" class="headerlink" title="1. Swap 配置"></a>1. Swap 配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建 4GB Swap</span><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/swapfile bs=1M count=4096<br>mkswap /swapfile<br>swapon /swapfile<br></code></pre></td></tr></table></figure><h4 id="2-内存限制"><a href="#2-内存限制" class="headerlink" title="2. 内存限制"></a>2. 内存限制</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;agents&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;defaults&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;maxMemory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2g&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="Q-如何备份？"><a href="#Q-如何备份？" class="headerlink" title="Q: 如何备份？"></a>Q: 如何备份？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 备份配置</span><br><span class="hljs-built_in">cp</span> -r ~/.openclaw ~/backup-openclaw-$(<span class="hljs-built_in">date</span> +%Y%m%d)<br><br><span class="hljs-comment"># 备份数据</span><br><span class="hljs-built_in">cp</span> -r ~/.cache/qmd ~/backup-qmd-$(<span class="hljs-built_in">date</span> +%Y%m%d)<br></code></pre></td></tr></table></figure><h3 id="Q-Agent-没响应？"><a href="#Q-Agent-没响应？" class="headerlink" title="Q: Agent 没响应？"></a>Q: Agent 没响应？</h3><ol><li>检查 API Key 配置</li><li>查看日志 <code>openclaw logs</code></li><li>重启 Gateway <code>openclaw gateway restart</code></li></ol><h3 id="Q-内存不足？"><a href="#Q-内存不足？" class="headerlink" title="Q: 内存不足？"></a>Q: 内存不足？</h3><ol><li>添加 Swap</li><li>降低并发数</li><li>关闭不需要的 Skills</li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>OpenClaw 是一个强大的 AI 助手网关：</p><ul><li>✅ <strong>多平台</strong>：Telegram、Discord 等</li><li>✅ <strong>强 Agent</strong>：Pi、Claude Code</li><li>✅ <strong>好记忆</strong>：QMD 向量检索</li><li>✅ <strong>易扩展</strong>：Skills 生态</li><li>✅ <strong>够安全</strong>：本地部署</li></ul><p><strong>让 AI 助手随时随地为你服务！</strong></p><hr><p><strong>Tags</strong>: OpenClaw, AI, Telegram, Agent, Gateway, Skills, QMD</p><p><strong>系列文章</strong>：</p><ul><li><a href="./OpenClaw-%E6%8A%98%E8%85%BE%E8%AE%B0">OpenClaw 折腾记</a></li><li><a href="./QMD-%E5%90%91%E9%87%8F%E8%AE%B0%E5%BF%86%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95">QMD 向量记忆高级用法</a></li><li>OpenClaw 概览与核心功能 ✅</li></ul>]]></content>
    
    
    <categories>
      
      <category>技术</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OpenClaw</tag>
      
      <tag>AI</tag>
      
      <tag>Telegram</tag>
      
      <tag>Agent</tag>
      
      <tag>Gateway</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>QMD 向量记忆高级用法 - 打造你的第二大脑</title>
    <link href="/2026/02/06/QMD-%E5%90%91%E9%87%8F%E8%AE%B0%E5%BF%86%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/"/>
    <url>/2026/02/06/QMD-%E5%90%91%E9%87%8F%E8%AE%B0%E5%BF%86%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="QMD-向量记忆高级用法-打造你的第二大脑"><a href="#QMD-向量记忆高级用法-打造你的第二大脑" class="headerlink" title="QMD 向量记忆高级用法 - 打造你的第二大脑"></a>QMD 向量记忆高级用法 - 打造你的第二大脑</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在信息爆炸的时代，如何高效检索信息成为关键。QMD (Quick Markdown) 不仅仅是一个搜索工具，它是你的<strong>第二大脑</strong>。</p><h2 id="什么是向量检索？"><a href="#什么是向量检索？" class="headerlink" title="什么是向量检索？"></a>什么是向量检索？</h2><h3 id="传统搜索-vs-向量搜索"><a href="#传统搜索-vs-向量搜索" class="headerlink" title="传统搜索 vs 向量搜索"></a>传统搜索 vs 向量搜索</h3><table><thead><tr><th>对比项</th><th>传统搜索 (BM25)</th><th>向量搜索</th></tr></thead><tbody><tr><td>原理</td><td>关键词匹配</td><td>语义理解</td></tr><tr><td>能力</td><td>精确匹配</td><td>模糊理解</td></tr><tr><td>速度</td><td>快</td><td>稍慢</td></tr><tr><td>场景</td><td>专业术语</td><td>日常表达</td></tr></tbody></table><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile"><span class="hljs-section">搜索: &quot;我的投资基金表现如何&quot;</span><br><br>BM25 结果: 匹配 <span class="hljs-string">&quot;基金&quot;</span> 关键词的文章<br><span class="hljs-section">向量搜索: 理解语义，找到所有关于投资、收益、持仓的文章</span><br></code></pre></td></tr></table></figure><h2 id="OpenClaw-QMD-配置"><a href="#OpenClaw-QMD-配置" class="headerlink" title="OpenClaw QMD 配置"></a>OpenClaw QMD 配置</h2><h3 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;memory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;backend&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;qmd&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;qmd&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;includeDefaultMemory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;update&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;interval&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5m&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;debounceMs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15000</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;limits&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;maxResults&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;timeoutMs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4000</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="命令行用法"><a href="#命令行用法" class="headerlink" title="命令行用法"></a>命令行用法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 全文搜索 (BM25)</span><br>qmd search <span class="hljs-string">&quot;基金 持仓&quot;</span><br><br><span class="hljs-comment"># 向量相似度搜索</span><br>qmd vsearch <span class="hljs-string">&quot;我的投资偏好&quot;</span><br><br><span class="hljs-comment"># 混合搜索 (推荐)</span><br>qmd query <span class="hljs-string">&quot;最近买了什么股票&quot;</span><br><br><span class="hljs-comment"># 指定集合搜索</span><br>qmd query <span class="hljs-string">&quot;工作安排&quot;</span> -c memory<br><br><span class="hljs-comment"># JSON 格式输出</span><br>qmd query <span class="hljs-string">&quot;项目进度&quot;</span> --json<br></code></pre></td></tr></table></figure><h2 id="实战场景"><a href="#实战场景" class="headerlink" title="实战场景"></a>实战场景</h2><h3 id="场景-1：快速回顾对话"><a href="#场景-1：快速回顾对话" class="headerlink" title="场景 1：快速回顾对话"></a>场景 1：快速回顾对话</h3><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">$ qmd query <span class="hljs-string">&quot;昨天讨论的 AI 项目&quot;</span><br><br>结果:<br>- 匹配度 <span class="hljs-number">85</span><span class="hljs-comment">%: 2026-02-04.md - AI Agent 测试记录</span><br>- 匹配度 <span class="hljs-number">72</span><span class="hljs-comment">%: 项目计划.md - Agent 集成方案</span><br></code></pre></td></tr></table></figure><h3 id="场景-2：跨时间检索"><a href="#场景-2：跨时间检索" class="headerlink" title="场景 2：跨时间检索"></a>场景 2：跨时间检索</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 搜索所有关于 &quot;投资&quot; 的记录</span><br>qmd search <span class="hljs-string">&quot;投资&quot;</span> --all<br><br><span class="hljs-comment"># 搜索最近一个月的记录</span><br>qmd query <span class="hljs-string">&quot;基金走势&quot;</span> --min-score 0.5<br></code></pre></td></tr></table></figure><h3 id="场景-3：精准定位"><a href="#场景-3：精准定位" class="headerlink" title="场景 3：精准定位"></a>场景 3：精准定位</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 获取完整文档</span><br>qmd get qmd://memory/2026-02-05.md<br><br><span class="hljs-comment"># 多文档获取</span><br>qmd multi-get <span class="hljs-string">&quot;qmd://memory/*.md&quot;</span> --json<br></code></pre></td></tr></table></figure><h2 id="高级技巧"><a href="#高级技巧" class="headerlink" title="高级技巧"></a>高级技巧</h2><h3 id="1-优化检索质量"><a href="#1-优化检索质量" class="headerlink" title="1. 优化检索质量"></a>1. 优化检索质量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 提高相似度阈值，过滤低质量结果</span><br>qmd query <span class="hljs-string">&quot;关键词&quot;</span> --min-score 0.7<br><br><span class="hljs-comment"># 扩大搜索范围</span><br>qmd query <span class="hljs-string">&quot;内容&quot;</span> -n 10<br></code></pre></td></tr></table></figure><h3 id="2-集合管理"><a href="#2-集合管理" class="headerlink" title="2. 集合管理"></a>2. 集合管理</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看所有集合</span><br>qmd collection list<br><br><span class="hljs-comment"># 创建新集合</span><br>qmd collection add /path/to/notes --name my-notes<br><br><span class="hljs-comment"># 删除集合</span><br>qmd collection remove old-notes<br></code></pre></td></tr></table></figure><h3 id="3-索引维护"><a href="#3-索引维护" class="headerlink" title="3. 索引维护"></a>3. 索引维护</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 强制重新索引</span><br>qmd update --pull<br><br><span class="hljs-comment"># 清理无用数据</span><br>qmd cleanup<br><br><span class="hljs-comment"># 查看索引状态</span><br>qmd status<br></code></pre></td></tr></table></figure><h2 id="QMD-工作原理"><a href="#QMD-工作原理" class="headerlink" title="QMD 工作原理"></a>QMD 工作原理</h2><h3 id="向量嵌入模型"><a href="#向量嵌入模型" class="headerlink" title="向量嵌入模型"></a>向量嵌入模型</h3><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">Embedding 模型</span><span class="hljs-punctuation">:</span> <span class="hljs-string">embeddinggemma-300M-Q8_0</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">轻量级模型，适合 VPS</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">300M 参数</span><br><span class="hljs-bullet">-</span> <span class="hljs-string">本地运行，不依赖外部 API</span><br></code></pre></td></tr></table></figure><h3 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">~/.cache/qmd/index.sqlite<br><span class="hljs-bullet">- </span>向量索引<br><span class="hljs-bullet">- </span>BM25 索引<br><span class="hljs-bullet">- </span>元数据<br></code></pre></td></tr></table></figure><h2 id="与-OpenClaw-集成"><a href="#与-OpenClaw-集成" class="headerlink" title="与 OpenClaw 集成"></a>与 OpenClaw 集成</h2><h3 id="配置-memory-core"><a href="#配置-memory-core" class="headerlink" title="配置 memory-core"></a>配置 memory-core</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;memory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;backend&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;qmd&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;memory-core&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;enabled&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="可用工具"><a href="#可用工具" class="headerlink" title="可用工具"></a>可用工具</h3><table><thead><tr><th>工具</th><th>功能</th></tr></thead><tbody><tr><td><code>memory_search</code></td><td>QMD 搜索</td></tr><tr><td><code>memory_get</code></td><td>获取记忆内容</td></tr><tr><td><code>memory_list</code></td><td>列出所有记忆</td></tr></tbody></table><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="Q-向量搜索崩溃"><a href="#Q-向量搜索崩溃" class="headerlink" title="Q: 向量搜索崩溃"></a>Q: 向量搜索崩溃</h3><p><strong>问题</strong>: Bun 1.3.8 + node-llama-cpp 兼容问题</p><p><strong>解决</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 方案1: 使用 BM25</span><br>qmd search <span class="hljs-string">&quot;关键词&quot;</span><br><br><span class="hljs-comment"># 方案2: 重装 QMD</span><br>git <span class="hljs-built_in">clone</span> https://github.com/tobi/qmd.git<br><span class="hljs-built_in">cd</span> qmd &amp;&amp; bun install<br></code></pre></td></tr></table></figure><h3 id="Q-搜索结果不准确"><a href="#Q-搜索结果不准确" class="headerlink" title="Q: 搜索结果不准确"></a>Q: 搜索结果不准确</h3><p><strong>解决</strong>:</p><ol><li>增加文档数量</li><li>提高检索阈值</li><li>使用混合搜索 <code>query</code> 而非单一 <code>search</code></li></ol><h3 id="Q-索引过大"><a href="#Q-索引过大" class="headerlink" title="Q: 索引过大"></a>Q: 索引过大</h3><p><strong>解决</strong>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 清理无用数据</span><br>qmd cleanup<br><br><span class="hljs-comment"># 移除不需要的集合</span><br>qmd collection remove unused-collection<br></code></pre></td></tr></table></figure><h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><h3 id="1-命名规范"><a href="#1-命名规范" class="headerlink" title="1. 命名规范"></a>1. 命名规范</h3><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs subunit"># 推荐命名<br>2026<span class="hljs-string">-02</span><span class="hljs-string">-06</span>-项目计划.md<br>2026<span class="hljs-string">-02</span><span class="hljs-string">-05</span>-投资笔记.md<br>对话<span class="hljs-string">-2026</span><span class="hljs-string">-02</span><span class="hljs-string">-04</span>-AI讨论.md<br></code></pre></td></tr></table></figure><h3 id="2-内容结构"><a href="#2-内容结构" class="headerlink" title="2. 内容结构"></a>2. 内容结构</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-section"># 标题</span><br><br><span class="hljs-section">## 关键信息</span><br><span class="hljs-bullet">-</span> 时间<br><span class="hljs-bullet">-</span> 人物<br><span class="hljs-bullet">-</span> 地点<br><br><span class="hljs-section">## 详细内容</span><br><br><span class="hljs-section">## 结论/行动项</span><br></code></pre></td></tr></table></figure><h3 id="3-定期维护"><a href="#3-定期维护" class="headerlink" title="3. 定期维护"></a>3. 定期维护</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 每周执行</span><br>qmd update  <span class="hljs-comment"># 更新索引</span><br>qmd cleanup  <span class="hljs-comment"># 清理垃圾</span><br>qmd status  <span class="hljs-comment"># 检查状态</span><br></code></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>QMD + OpenClaw 让我实现了：</p><ul><li>✅ <strong>精准检索</strong>：不用记住文件名，记住关键词就行</li><li>✅ <strong>语义理解</strong>：用自然语言搜索</li><li>✅ <strong>完全本地</strong>：数据在自己手里</li><li>✅ <strong>零成本</strong>：不需要外部 API</li></ul><p><strong>你的第二大脑，从 QMD 开始！</strong></p><hr><p><strong>Tags</strong>: QMD, 向量检索, 语义搜索, OpenClaw, AI, 知识管理</p>]]></content>
    
    
    <categories>
      
      <category>技术</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OpenClaw</tag>
      
      <tag>AI</tag>
      
      <tag>QMD</tag>
      
      <tag>向量检索</tag>
      
      <tag>语义搜索</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenClaw 折腾记 - 从 Telegram AI 助手到向量记忆系统</title>
    <link href="/2026/02/06/OpenClaw-%E6%8A%98%E8%85%BE%E8%AE%B0/"/>
    <url>/2026/02/06/OpenClaw-%E6%8A%98%E8%85%BE%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="OpenClaw-折腾记-从-Telegram-AI-助手到向量记忆系统"><a href="#OpenClaw-折腾记-从-Telegram-AI-助手到向量记忆系统" class="headerlink" title="OpenClaw 折腾记 - 从 Telegram AI 助手到向量记忆系统"></a>OpenClaw 折腾记 - 从 Telegram AI 助手到向量记忆系统</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>作为一个热爱折腾的普通人，我一直在寻找一个能够随时随地与 AI 对话解决方案。直到发现了 OpenClaw —— 一个开源的 AI 助手框架。</p><h2 id="什么是-OpenClaw？"><a href="#什么是-OpenClaw？" class="headerlink" title="什么是 OpenClaw？"></a>什么是 OpenClaw？</h2><p>OpenClaw 是一个开源的 AI 助手网关，具有以下特点：</p><ul><li><strong>多平台支持</strong>：Telegram、WhatsApp、Discord、iMessage 等</li><li><strong>Agent 能力</strong>：集成 Claude Code、Pi 等编程 Agent</li><li><strong>本地化部署</strong>：数据完全掌握在自己手中</li><li><strong>可扩展性</strong>：通过 Skills 扩展功能</li></ul><p>我的使用场景：</p><ol><li>📱 在手机上通过 Telegram 与 AI 对话</li><li>🧠 QMD 向量记忆系统，精准检索</li><li>📊 基金数据自动追踪</li><li>🛠️ VPS 运维工具箱</li></ol><hr><h2 id="第一章：QMD-向量记忆系统配置"><a href="#第一章：QMD-向量记忆系统配置" class="headerlink" title="第一章：QMD 向量记忆系统配置"></a>第一章：QMD 向量记忆系统配置</h2><p>OpenClaw 最新版内置了 QMD 支持，这是一个强大的语义搜索工具。</p><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><ol><li>修改 <code>~/.openclaw/openclaw.json</code>：</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;memory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;backend&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;qmd&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;qmd&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;includeDefaultMemory&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;update&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;interval&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;5m&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;debounceMs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">15000</span><br>      <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;limits&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;maxResults&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;timeoutMs&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4000</span><br>      <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><ol start="2"><li>使用命令：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 全文搜索 (BM25)</span><br>qmd search <span class="hljs-string">&quot;基金&quot;</span><br><br><span class="hljs-comment"># 向量搜索</span><br>qmd vsearch <span class="hljs-string">&quot;我的投资偏好&quot;</span><br><br><span class="hljs-comment"># 混合搜索</span><br>qmd query <span class="hljs-string">&quot;持仓基金走势&quot;</span><br></code></pre></td></tr></table></figure><h3 id="🐛-遇到的问题：Bun-兼容问题"><a href="#🐛-遇到的问题：Bun-兼容问题" class="headerlink" title="🐛 遇到的问题：Bun 兼容问题"></a>🐛 遇到的问题：Bun 兼容问题</h3><blockquote><p><strong>问题现象</strong>：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">panic</span>: Segmentation fault at address <span class="hljs-number">0</span>x7FCF86E3E840<br><span class="hljs-attribute">Peak</span>: <span class="hljs-number">6</span>.<span class="hljs-number">58</span>GB | Machine: <span class="hljs-number">10</span>.<span class="hljs-number">42</span>GB<br></code></pre></td></tr></table></figure></blockquote><p><strong>解决方案</strong>：</p><p>最终解决方案：<strong>手动从源码安装 QMD</strong>，并保持 Bun 1.3.8。</p><hr><h2 id="第二章：基金数据自动追踪"><a href="#第二章：基金数据自动追踪" class="headerlink" title="第二章：基金数据自动追踪"></a>第二章：基金数据自动追踪</h2><h3 id="部署方案"><a href="#部署方案" class="headerlink" title="部署方案"></a>部署方案</h3><ol><li><p>创建数据获取脚本</p></li><li><p>配置定时任务：</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># crontab -e</span><br>0 15 * * * <span class="hljs-built_in">cd</span> /root/.openclaw &amp;&amp; python3 scripts/fetch_fund_nav.py<br></code></pre></td></tr></table></figure><h3 id="数据展示"><a href="#数据展示" class="headerlink" title="数据展示"></a>数据展示</h3><p>通过 OpenClaw 的 QMD 搜索，可以快速检索历史数据。</p><hr><h2 id="第三章：VPS-优化"><a href="#第三章：VPS-优化" class="headerlink" title="第三章：VPS 优化"></a>第三章：VPS 优化</h2><h3 id="添加-Swap-空间"><a href="#添加-Swap-空间" class="headerlink" title="添加 Swap 空间"></a>添加 Swap 空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 创建 4GB Swap 文件</span><br><span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/swapfile bs=1M count=4096<br>mkswap /swapfile<br>swapon /swapfile<br><br><span class="hljs-comment"># 永久生效</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/swapfile none swap sw 0 0&quot;</span> &gt;&gt; /etc/fstab<br></code></pre></td></tr></table></figure><p>效果：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Mem</span>:           <span class="hljs-number">9</span>.<span class="hljs-number">7</span>Gi       <span class="hljs-number">692</span>Mi       <span class="hljs-number">5</span>.<span class="hljs-number">3</span>Gi<br><span class="hljs-attribute">Swap</span>:          <span class="hljs-number">4</span>.<span class="hljs-number">0</span>Gi          <span class="hljs-number">0</span>B       <span class="hljs-number">4</span>.<span class="hljs-number">0</span>Gi<br></code></pre></td></tr></table></figure><hr><h2 id="第四章：Hexo-博客部署"><a href="#第四章：Hexo-博客部署" class="headerlink" title="第四章：Hexo 博客部署"></a>第四章：Hexo 博客部署</h2><h3 id="部署步骤"><a href="#部署步骤" class="headerlink" title="部署步骤"></a>部署步骤</h3><ol><li>安装 Node.js 和 Hexo：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 使用 nvm 安装</span><br>curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash<br>nvm install --lts<br>npm install -g hexo-cli<br></code></pre></td></tr></table></figure><ol start="2"><li>初始化博客：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo init /var/www/blog<br><span class="hljs-built_in">cd</span> /var/www/blog<br>hexo theme next<br></code></pre></td></tr></table></figure><ol start="3"><li>配置 Caddy 自动 HTTPS：</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs caddyfile">blog.2001.life &#123;<br>    root * /var/www/blog/public<br>    file_server<br>    encode gzip<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过这段时间的折腾，我获得了：</p><ol><li>✅ <strong>随时可用的 AI 助手</strong> - Telegram 随时对话</li><li>✅ <strong>精准的记忆系统</strong> - QMD 向量检索</li><li>✅ <strong>自动化的基金追踪</strong> - 每日净值数据</li><li>✅ <strong>安全的 VPS 配置</strong> - Swap + SSH 加固</li><li>✅ <strong>独立的博客系统</strong> - Hexo + Caddy 自动 HTTPS</li></ol><p><strong>心得</strong>：</p><ul><li>遇到问题不要慌，善用搜索和社区资源</li><li>保留原始配置，备份是关键</li><li>记录过程，既是总结也是分享</li></ul><hr><p><strong>Tags</strong>: OpenClaw, AI, Telegram, QMD, Hexo, VPS</p>]]></content>
    
    
    <categories>
      
      <category>技术</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OpenClaw</tag>
      
      <tag>AI</tag>
      
      <tag>Telegram</tag>
      
      <tag>QMD</tag>
      
      <tag>Hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2026/02/06/hello-world/"/>
    <url>/2026/02/06/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>🔢 向量化：让机器更 “懂”人类文字</title>
    <link href="/2025/10/20/2025-10-20-81/"/>
    <url>/2025/10/20/2025-10-20-81/</url>
    
    <content type="html"><![CDATA[<h1 id="🔢-向量化：让机器更-“懂”人类文字"><a href="#🔢-向量化：让机器更-“懂”人类文字" class="headerlink" title="🔢 向量化：让机器更 “懂”人类文字"></a>🔢 向量化：让机器更 “懂”人类文字</h1><p>科研人在检索论文的时候一定有过这种感觉——研究方向的关键词检索，往往检索不到所有可能启发我们的论文。因为技术是通用的，完全可能有别的领域的论文所做的工作和我们领域的类似，但由于我们搜索的仅仅是我们领域的关键词，于是检索不到，错失了可能的启发。</p><p>我的研究场景是 <code>MobileCrowdsensing</code> ，其实 <code>Crowdsourcing</code> 也是类似的场景，但我在检索的时候往往要分别检索这两个关键词来寻找论文，这便是单纯文本匹配检索的弊端。</p><p>还有我们的工作可能包含分布式的无人机行动规划，其实这种规划类似于自动驾驶的规划，完全可以从中参照，因此简单的检索引擎也会让我错失一些启发性的优质文章。</p><h2 id="向量化是啥"><a href="#向量化是啥" class="headerlink" title="向量化是啥"></a>向量化是啥</h2><p>“我喜欢吃苹果。”<br>“我爱吃水果。”</p><p>这两句话<strong>意思接近</strong>，它们在<strong>高维空间的“距离”也很近</strong>。<br>而“我在写代码”那条向量，就离它们老远。</p><p>计算机通过这种方式“感受”语义上的相似程度，<br>有点像人脑中的联想机制。</p><hr><h2 id="为什么要向量化"><a href="#为什么要向量化" class="headerlink" title="为什么要向量化"></a>为什么要向量化</h2><p>以前的搜索是关键词匹配——你搜“程序员”，它找不到“开发者”。<br>但向量化不看字面，而是看语义。</p><p>这就是为什么在 RAG（检索增强生成）系统里，<br>我们要先把所有文档都向量化、存进数据库。<br>当用户提问时，也把问题向量化，再找“最近”的那几段内容给模型看。<br>模型就能在有上下文的前提下回答问题。</p><p>一句话：向量化让模型先理解，再回答。</p><hr><h2 id="向量是怎么来的"><a href="#向量是怎么来的" class="headerlink" title="向量是怎么来的"></a>向量是怎么来的</h2><p>靠的是 <strong>Embedding 模型</strong>。<br>比如 OpenAI 的 text-embedding-3、阿里百炼的 text-embedding-v2、<br>还有开源的 bge-large、m3e 等。</p><p>这些模型经过大规模语料训练，能把语义转成数字。<br>比如一句话会被转成一个 1024 维的数组 [0.12, -0.03, 0.85, …]，<br>我们看不懂，但在机器眼里，这就是“意思”。</p><hr><h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>向量化让机器能够进行“语义检索”，更好地“理解”人类语言。<br>想想向量化有点像人类的思考，我们的脑海中 巴士 和 公交 映射出来的画面大概率都是一辆 🚌，于是这两个词的向量距离就相近，当有人在公交站和我们说 巴士怎么还不来 的时候，我们理所当然的能够理解是在说我们等的车怎么还不来。</p>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>RAG 与 模型幻觉</title>
    <link href="/2025/10/20/2025-10-20-80/"/>
    <url>/2025/10/20/2025-10-20-80/</url>
    
    <content type="html"><![CDATA[<h1 id="🤯-RAG-与大模型幻觉：让模型“说真话”的秘密武器"><a href="#🤯-RAG-与大模型幻觉：让模型“说真话”的秘密武器" class="headerlink" title="🤯 RAG 与大模型幻觉：让模型“说真话”的秘密武器"></a>🤯 RAG 与大模型幻觉：让模型“说真话”的秘密武器</h1><p>如果你经常和 ChatGPT、通义千问之类的大模型打交道，你大概见识过它一本正经地胡说八道的样子。<br>比如你问它：“我上周的论文标题是什么？”<br>它会一本正经地回答：“《跨模态差分隐私下的自适应生成网络研究》。”<br>听起来很专业，但——根本不存在。</p><p>这就是所谓的 <strong>幻觉</strong>。</p><hr><h2 id="幻觉从哪来？"><a href="#幻觉从哪来？" class="headerlink" title="幻觉从哪来？"></a>幻觉从哪来？</h2><p>简单说，语言模型的核心任务是“预测下一个词”。它并不真正理解事实，只是在大量语料中学习“词语搭配的概率”。当你问它问题时，它会根据语义猜一个“看起来合理的答案”，<br><strong>但并不保证那是真的</strong>。</p><hr><h2 id="RAG-是怎么帮忙的？"><a href="#RAG-是怎么帮忙的？" class="headerlink" title="RAG 是怎么帮忙的？"></a>RAG 是怎么帮忙的？</h2><p>RAG（Retrieval-Augmented Generation）可以理解为模型的外置事实引擎。<br>它不再“凭记忆瞎猜”，而是先去查资料。</p><p>当你提问时，系统会先用检索模型（embedding + 向量库）找出与问题最相关的知识片段，再把这些片段拼进 prompt 一起交给模型生成。</p><hr><h2 id="为什么-RAG-不能完全消灭幻觉？"><a href="#为什么-RAG-不能完全消灭幻觉？" class="headerlink" title="为什么 RAG 不能完全消灭幻觉？"></a>为什么 RAG 不能完全消灭幻觉？</h2><p>RAG 能显著降低幻觉，但无法完全消灭。原因有三：</p><ol><li><strong>检索不准</strong>：如果向量库召回了错误片段，模型仍然可能胡说。</li><li><strong>引用不严谨</strong>：模型有时会“二次加工”资料，把原话改得面目全非。</li><li><strong>知识缺失</strong>：如果知识库本身没有这条信息，RAG 也帮不了忙。</li></ol><p>换句话说，RAG 不是防幻觉的“护身符”，而是一个让模型“有依据可查”的事实来源。</p><hr><h2 id="工程实践：如何让-RAG-更可靠？"><a href="#工程实践：如何让-RAG-更可靠？" class="headerlink" title="工程实践：如何让 RAG 更可靠？"></a>工程实践：如何让 RAG 更可靠？</h2><p>实践中想让 RAG 真正降低幻觉，需要几条关键策略：</p><ul><li><strong>知识分段合理</strong>：段太长检索不准，太短语义碎。</li><li><strong>embedding 模型质量</strong>高：保证语义相似度匹配准确。</li><li>检索 + rerank <strong>混合召回</strong>：向量 + BM25 双保险。</li><li><strong>Prompt</strong> 结构清晰：提示模型“请仅根据以下内容回答”。</li><li><strong>引用验证</strong>：生成结果后可做语义比对，检测回答是否出自检索文本。</li></ul><p>有些企业项目甚至会在 RAG 结果上再套一层 “Fact Check 模块”，<br>自动比对生成内容与原文相似度，<strong>进一步过滤幻觉</strong>。</p><hr><h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>RAG 其实是利用知识库来为模型提供上下文，以给出相对可靠的答案。但是在过程中，由于<strong>回答是由AI给出</strong>，即便有了相关的上下文，仍然可能给出不靠谱的答案；另外知识库中检索出来的知识精度（<strong>召回率</strong>）也是一大影响，只有准确的检索才能引导模型给出靠谱的答案，因此可以从<strong>embedding模型、输出验证等</strong>下手，提高回答精度。</p>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>RAG 是什么</title>
    <link href="/2025/10/20/2025-10-20-78/"/>
    <url>/2025/10/20/2025-10-20-78/</url>
    
    <content type="html"><![CDATA[<h1 id="RAG-是什么？为什么它成了大模型落地的“标配”？"><a href="#RAG-是什么？为什么它成了大模型落地的“标配”？" class="headerlink" title="RAG 是什么？为什么它成了大模型落地的“标配”？"></a>RAG 是什么？为什么它成了大模型落地的“标配”？</h1><p><img src="https://images/typecho//2025/10/790909958.png" alt="2025-10-20T09:09:12.png"><br>最近几年，RAG（Retrieval-Augmented Generation，检索增强生成）这个词几乎成了大模型落地项目的标配。无论是知识问答、文档助手，还是企业智能客服，都在说自己是“RAG 架构”。</p><p>简单来说，RAG 是一种让大语言模型具备“外部记忆”的方法。传统模型回答问题完全依赖训练参数，但训练数据有时效性，模型并不知道最新的业务或文档。而 RAG 的做法是——在生成答案前，先去知识库里检索相关信息，再让模型基于这些资料回答。这就像模型身边多了个“资料管理员”📚，让它能即时查阅、即时回答。</p><p>工作原理其实不复杂：<br>当我们提问时，系统会先用一个 <strong>Embedding 模型</strong>把问题向量化，然后去向量数据库（如 Milvus、Faiss、Elasticsearch 等）中找到最相似的文档片段。接着，这些片段会被拼进 prompt，一起传给大语言模型生成回答。这样模型既能保持语言能力，又能引用你提供的知识。</p><p>相比直接问模型，RAG 有三个明显好处：</p><ol><li>模型能回答“它原本不知道”的内容，比如公司内部政策、产品手册。</li><li>回答更可信，不容易胡说八道（虽然还不能完全避免 🤔）。</li><li>更新方便，只要改知识库，不用重新微调模型。</li></ol><p>举个常见的例子：企业知识问答。过去，员工问“我们的审批流程是几步？”，得去翻文档。现在用 RAG，只要提前把文档分段嵌入数据库，员工提问后系统检索出相关段落，再交给模型生成一句自然的回答：“审批流程共三步，分别是…”。既快又准。</p><p>当然，RAG 不是万能的。检索粒度、向量质量、上下文拼接都很影响效果。段落太大找不准，太小又容易丢语义；<strong>Embedding 模型</strong>选不好，相似度也不准。实践中，“检索比生成更重要”几乎是金科玉律。</p><p>现在，很多团队在探索更聪明的 RAG，比如混合召回（向量+BM25）、Graph RAG（知识图谱增强）、多轮上下文记忆等。RAG 不再只是“查资料”，而是演化成一种能动态理解和整合知识的框架。</p><p>RAG 的意义在于——它让大模型真正具备“知识更新”能力，而不用重新训练。<br>对于企业来说，这是一条极具性价比的落地路线：</p><ol><li>数据自己掌控，</li><li>模型灵活组合，</li><li>系统能随时更新。</li></ol><p>一句话总结：</p><blockquote><p>RAG 让模型不止会“说”，还能“查”与“懂”。</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>RocketMQ 应用：工作流和服务解耦</title>
    <link href="/2025/10/11/2025-10-11-76/"/>
    <url>/2025/10/11/2025-10-11-76/</url>
    
    <content type="html"><![CDATA[<h1 id="RocketMQ应用：工作流和服务解耦"><a href="#RocketMQ应用：工作流和服务解耦" class="headerlink" title="RocketMQ应用：工作流和服务解耦"></a>RocketMQ应用：工作流和服务解耦</h1><p><img src="https://images/typecho//2025/10/1922781609.png" alt="2025-10-10T12:44:13.png"><br>整个工作流程由 <code>Workflow</code> 服务调度，其他微服务都订阅了与自己任务相关的主题，主题的消息由Workflow的producer发送，同时Workflow也监听其他微服务返回的结果，由返回的结果触发对应的producer。</p>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>RocketMQ消息队列编排工作流</title>
    <link href="/2025/10/10/2025-10-10-71/"/>
    <url>/2025/10/10/2025-10-10-71/</url>
    
    <content type="html"><![CDATA[<h1 id="RocketMQ-消息队列"><a href="#RocketMQ-消息队列" class="headerlink" title="RocketMQ 消息队列"></a>RocketMQ 消息队列</h1><h2 id="什么是消息队列？"><a href="#什么是消息队列？" class="headerlink" title="什么是消息队列？"></a>什么是消息队列？</h2><p>消息队列顾名思义就是把消息放到一个队列里，从消息队列中获取消息的行为我们称之为<strong>消费</strong>，需要消费消息的消费者自行从消息队列中获取消息，那么就引出了消息队列的第一个特性——<strong>解耦</strong>。</p><ol><li><strong>解耦</strong>：如果没有消息队列：我们将服务A的消息发送给服务B和服务C，后续又新增了服务D需要服务A的消息，服务C不需要A的消息了，那么就需要对一个个服务进行具体的更改。在引入消息队列之后，我们只需要将消息丢到队列里，需要的自取就可以了，实现了服务的解耦。</li></ol><p>先放到队列里，有需要的服务自取消息，那么这种模式又有什么特性呢？——<strong>异步</strong>。<br>2. <strong>异步</strong>：许多提交材料返回结果的操作都具有异步的特性，为什么需要异步性呢，因为同步的操作太耗费时间了，提交–&gt;处理–&gt;返回，如果是需要处理的请求特别多，那么返回的时间还会大幅增加，没有必要让用户持续等待，我们完全可以在用户提交后异步处理，处理完成后再通知用户。</p><pre><code class="hljs">异步处理拆解为：**提交--&gt;已经提交，处理--&gt;处理完成，通知--&gt;通知完成**。三者中间通过消息队列串联起来就可以了，大大降低了每个请求的响应时间，提升了用户的体验。这就是消息队列的第二个用途，服务解耦。</code></pre><p>异步意味着服务不必实时处理请求，那么这种模式又可以带来什么呢？——<strong>削峰</strong>。<br>3. <strong>削弱峰</strong>：当大量的请求涌入，这在生活中完全是可能的（秒杀、抢票等高并发场景），请求的波峰是无法避免的，同步的操作中服务器的负载也是随着请求而波动，但是异步操作使得我们可以根据服务器的能力均衡负载，<strong>请求存入消息队列–&gt;服务器根据自己能力从中消费请求</strong>，使得系统负载稳定，避免大幅波动，保障服务正常运行。</p><h2 id="几种消息队列"><a href="#几种消息队列" class="headerlink" title="几种消息队列"></a>几种消息队列</h2><table><thead><tr><th>特性</th><th>Kafka</th><th>ActiveMQ</th><th>RabbitMQ</th><th>RocketMQ</th></tr></thead><tbody><tr><td><strong>功能支持</strong></td><td>分布式、分区、高吞吐量、流处理、持久化</td><td>JMS 支持、持久化、事务、消息过滤</td><td>消息路由、插件机制、持久化、多种协议支持</td><td>分布式、高吞吐量、事务、定时和延时消息、持久化</td></tr><tr><td><strong>可用性</strong></td><td>高（多副本机制、自动恢复）</td><td>高（支持主从架构和多种持久化机制）</td><td>高（镜像队列、集群模式）</td><td>高（多副本机制、集群模式）</td></tr><tr><td><strong>消息可靠性</strong></td><td>高（数据复制、多副本）</td><td>高（持久化存储、事务支持）</td><td>高（确认机制、持久化存储）</td><td>高（数据复制、多副本、持久化存储）</td></tr><tr><td><strong>时效性</strong></td><td>毫秒级（取决于配置和网络条件）</td><td>毫秒级（取决于配置和网络条件）</td><td>微秒级到毫秒级（取决于配置和网络条件）</td><td>毫秒级（取决于配置和网络条件）</td></tr><tr><td><strong>Topic 数量对吞吐量的影响</strong></td><td>影响较大（分区机制带来管理和资源消耗）</td><td>影响中等（队列管理开销）</td><td>影响较小（高效的路由机制）</td><td>影响中等（分区机制和管理开销）</td></tr><tr><td><strong>单机吞吐量</strong></td><td>高（百万级消息每秒）</td><td>中等（十万级消息每秒）</td><td>中等（十万级消息每秒）</td><td>高（百万级消息每秒）</td></tr><tr><td><strong>Client SDK</strong></td><td>多语言（Java、Scala、Python 等）</td><td>多语言（Java、C、C++ 等）</td><td>多语言（Java、Erlang、.NET 等）</td><td>多语言（Java、C++、Go 等）</td></tr></tbody></table><ul><li>其中Kafaka适合大数据领域的实时计算、日志采集场景，因为性能最高。</li><li>对实时性有要求，不关心底层，用RabbitMQ即可。</li><li>阿里的RocketMQ经历过618、双11等节点的考验，且具有丰富的教程，一般使用RocketMQ就可以。</li></ul><h2 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h2><p><img src="https://images/typecho//2025/10/2185089787.png" alt="2025-10-10T09:36:59.png">官网的RocketMQ部署模型图</p><p>RocketMQ 四大核心组件</p><table><thead><tr><th>部署架构部分</th><th>功能描述</th></tr></thead><tbody><tr><td><strong>生产者（Producer）</strong></td><td>发布消息的角色。Producer 通过 MQ 的负载均衡模块选择相应的 Broker 集群队列进行消息投递，投递过程支持快速失败和重试机制。</td></tr><tr><td><strong>消费者（Consumer）</strong></td><td>消息消费的角色。<br> - 支持 <strong>推（push）</strong> 和 <strong>拉（pull）</strong> 两种模式对消息进行消费。<br> - 支持 <strong>集群模式</strong> 和 <strong>广播模式</strong> 两种消费方式。<br> - 提供 <strong>实时消息订阅机制</strong>，可满足大多数用户的需求。</td></tr><tr><td><strong>名称服务器（NameServer）</strong></td><td>NameServer 是一个轻量级的 <strong>Topic 路由注册中心</strong>，支持 Topic、Broker 的动态注册与发现。<br><br>主要包含两个功能：<br>① <strong>Broker 管理</strong>：NameServer 接受 Broker 集群的注册信息并保存下来，作为路由信息的基础数据，并提供心跳检测机制检查 Broker 存活状态。<br>② <strong>路由信息管理</strong>：每个 NameServer 都会保存整个 Broker 集群的路由信息和客户端（Producer、Consumer）可查询的队列信息。Producer 和 Consumer 可通过 NameServer 获取 Broker 集群的路由信息，从而完成消息投递与消费。<br><br>此外，NameServer 通常会有多个实例部署，各实例之间互不通信。Broker 会向每台 NameServer 注册自己的路由信息，每个 NameServer 都保存完整副本。当某个 NameServer 下线时，客户端仍可从其他 NameServer 获取路由数据，保证系统高可用。</td></tr><tr><td><strong>代理服务器（Broker）</strong></td><td>Broker 负责 <strong>消息的存储、投递、查询</strong>，并保证服务的高可用。<br><br> - NameServer 为无状态节点，而 <strong>Broker 是集群的核心存储节点</strong>。<br> - 支持 <strong>Master–Slave 架构</strong>，Broker 可分为 Master 与 Slave。一个 Master 可对应多个 Slave，但每个 Slave 只能对应一个 Master。<br> - Master 与 Slave 的对应关系通过相同的 <code>BrokerName</code> 标识，不同的 <code>BrokerId</code> 区分（<code>BrokerId=0</code> 表示 Master，非 0 表示 Slave）。<br> - 每个 Broker 节点独立存储数据，Master 节点也可以部署多个以实现更高吞吐与容灾能力。</td></tr></tbody></table><p>RocketMQ 消息流转架构图<br><img src="https://images/typecho//2025/10/4172020056.png" alt="2025-10-10T09:47:04.png"></p><p>RocketMQ 消息流转时序图<br><img src="https://images/typecho//2025/10/3606436471.png" alt="2025-10-10T09:54:58.png"></p><h2 id="为什么用RocketMQ？"><a href="#为什么用RocketMQ？" class="headerlink" title="为什么用RocketMQ？"></a>为什么用RocketMQ？</h2><p>RocketMQ是一个天然的分布式组件，对于分布式微服务来说很好用。<br>业务场景对延时性要求不高，可以用RocketMQ。</p>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Redisson分布式锁避免重复提交任务</title>
    <link href="/2025/10/10/2025-10-10-70/"/>
    <url>/2025/10/10/2025-10-10-70/</url>
    
    <content type="html"><![CDATA[<h1 id="Redisson-分布式锁避免重复提交任务"><a href="#Redisson-分布式锁避免重复提交任务" class="headerlink" title="Redisson 分布式锁避免重复提交任务"></a>Redisson 分布式锁避免重复提交任务</h1><h2 id="为什么要引入-分布式锁-？"><a href="#为什么要引入-分布式锁-？" class="headerlink" title="为什么要引入 分布式锁 ？"></a>为什么要引入 <strong>分布式锁</strong> ？</h2><p>在本地锁场景下，已经能够解决本地服务下多线程竞争资源的同步问题，但是在分布式的场景下，服务A对资源x加锁，而服务B不受服务A的限制，若此时服务B也去访问资源B，就会出现数据不一致的问题，导致服务出错。</p><h2 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h2><p>分布式锁是分布式集群场景下共享的一种锁机制，保证了不同服务下的互斥性，任意时刻，<strong>只有一个客户端可以持有锁</strong>。<br>特性：</p><ul><li><strong>互斥性</strong>：同一时刻，只有一个客户端可以持有锁，不同线程之间具有互斥性，即便是跨服务。</li><li><strong>超时机制</strong>：正常情况下，持有锁的客户端执行完成之后释放锁，但是如果执行时发生异常，导致锁无法正确释放，就会造成<strong>死锁</strong>。<br>为了防止死锁，需要设置超时机制，超时自动释放。</li><li><strong>自动续期</strong>：超时机制会带来一个问题，如果持有锁的客户端在时间内无法完成任务，会导致任务还没完成就释放锁，这与我们的初衷是违背的（我们引入超时机制并不是为了阻碍正常的任务完成，而是为了解决潜在服务异常造成的死锁问题），因此，需要引入自动续期机制。<br>开启一个<strong>监听任务</strong>，监听线程，如果客户端还存活就<strong>延长</strong>超时时间，直到任务完成或者是任务异常。</li></ul><h2 id="几种实现方式"><a href="#几种实现方式" class="headerlink" title="几种实现方式"></a>几种实现方式</h2><ul><li>数据库</li><li>Zookeeper</li><li>Redis</li></ul><p>其中，Redis<strong>性能最高</strong>，方式有两种，一是利用SetNX（但是有<strong>死锁问题</strong>），而是<strong>Redisson</strong> ，也是最常用的。</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="直接实现"><a href="#直接实现" class="headerlink" title="直接实现"></a>直接实现</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs csharp">String lockKey = REVIEW_LOCK_PREFIX + taskId;<br>RLock <span class="hljs-keyword">lock</span> = redissonCilent.getLock(lockKey);<br><br><span class="hljs-keyword">try</span>&#123;<br>    <span class="hljs-comment">// 尝试获取锁（最多等待2秒，锁30秒后释放）</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">lock</span>.tryLock(<span class="hljs-number">2</span>, <span class="hljs-number">30</span>, TimeUnit.second)&#123;<br>        <span class="hljs-comment">// 任务执行逻辑</span><br>        <span class="hljs-comment">// ...</span><br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        log.info(<span class="hljs-string">&quot;任务 &#123;&#125; 正在被其他人员处理，跳过此次提交&quot;</span>, taskId);<br>    &#125;<br>&#125;<span class="hljs-keyword">catch</span>(InterruptedException e)&#123;<br>    Thread.currentThread().interrupt();<br>    log.info(<span class="hljs-string">&quot;线程终端，任务 &#123;&#125; 执行失败&quot;</span>, taskId);<br>&#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>    log.info(<span class="hljs-string">&quot;任务 &#123;&#125; 执行异常&quot;</span>, taskId);<br>&#125;<span class="hljs-keyword">finally</span>&#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">lock</span>.isHeldByCurrentThread)&#123;<br>        <span class="hljs-keyword">lock</span>.unlock();<br>        <span class="hljs-keyword">lock</span>.info(<span class="hljs-string">&quot;已释放锁 &#123;&#125;&quot;</span>, lockKey);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里假设任务比较简单，没有加入锁续期机制，如果要续期，使用<code>lock.lock()</code>可以自动实现看门狗的续期机制。</p><h4 id="注解式非入侵实现"><a href="#注解式非入侵实现" class="headerlink" title="注解式非入侵实现"></a>注解式非入侵实现</h4><p>直接实现分布式锁需要对具体方法进行代码改动，如果我们引入注解来实现，可以实现<strong>非入侵</strong>的分布式锁实现。</p><p>使用方式：</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nim">@<span class="hljs-type">DistributedLock</span>(key = <span class="hljs-string">&quot;#taskId&quot;</span>, prefix = <span class="hljs-string">&quot;precheck:&quot;</span>, leaseTime = <span class="hljs-number">30</span>)<br>public <span class="hljs-type">void</span> handlePrecheck(<span class="hljs-type">Long</span> taskId)<span class="hljs-meta">&#123;...&#125;</span><br></code></pre></td></tr></table></figure><p>只需要在方法之前加上自定义的分布式锁注解，使用起来十分轻便。</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs less">业务方法（<span class="hljs-variable">@DistributedLock</span>）<br>     │<br>     ▼<br>DistributedLockAspect（AOP拦截）<br>     │<br>     ├─ 解析 SpEL 表达式，得到完整锁 key<br>     │<br>     ├─ 调用 IDistributedLock.<span class="hljs-built_in">tryLock</span>(...)<br>     │<br>     │       │<br>     │       ▼<br>     │   RedissonDistributedLock（封装 Redisson 实现）<br>     │       │<br>     │       ├─ 获取 RLock<br>     │       ├─ 执行 <span class="hljs-built_in">tryLock</span>(...)<br>     │       ├─ 成功 → new <span class="hljs-built_in">ILock</span>(RLock, this)<br>     │       ▼<br>     │   返回 ILock（封装锁引用）<br>     │<br>     ├─ 执行业务逻辑 joinPoint.<span class="hljs-built_in">proceed</span>()<br>     │<br>     ├─ finally：lock.<span class="hljs-built_in">close</span>()<br>     │<br>     │       ▼<br>     │   ILock.<span class="hljs-built_in">close</span>()<br>     │       │<br>     │       └─ 调用 distributedLock.<span class="hljs-built_in">unlock</span>(lock)<br>     │<br>     │              │<br>     │              ▼<br>     │        RedissonDistributedLock.<span class="hljs-built_in">unlock</span>()<br>     │              ├─ 校验线程持有锁<br>     │              └─ 调用 RLock.<span class="hljs-built_in">unlock</span>()<br>     ▼<br>   🔓 锁释放<br></code></pre></td></tr></table></figure><p>那么如何实现呢？</p><ol><li>定义注解@DistributedLock <figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">public</span> @interface DistributedLock&#123;<br>    <span class="hljs-function">String <span class="hljs-title">key</span>()</span>; <br>    <span class="hljs-function">String <span class="hljs-title">prefix</span>() <span class="hljs-literal">default</span> &quot;<span class="hljs-keyword">lock</span>:&quot;</span>;<br>    <span class="hljs-function"><span class="hljs-built_in">long</span> <span class="hljs-title">tryTime</span>() <span class="hljs-literal">default</span> 30</span>; <span class="hljs-comment">// 尝试时间，30s</span><br>    <span class="hljs-function"><span class="hljs-built_in">long</span> <span class="hljs-title">leaseTime</span>() <span class="hljs-literal">default</span> 30</span>; <span class="hljs-comment">// 释放时间，30s</span><br>    <span class="hljs-function">TimeUnit <span class="hljs-title">unit</span>() <span class="hljs-literal">default</span> TimeUnit.Seconds</span>; <span class="hljs-comment">// 时间单位，秒</span><br>    boolean fair <span class="hljs-literal">default</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 默认非公平锁</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li>ILock 封装锁逻辑（策略模式） <figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ILock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AutoCloseable</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object lock;<br>    <span class="hljs-keyword">private</span> IDistributedLock distributedLock; <span class="hljs-comment">// 可以适应不同的分布式锁实现</span><br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        <span class="hljs-keyword">if</span>(lock != <span class="hljs-keyword">null</span>)&#123;<br>            distributedLock.unlock(lock);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure> ILock 将锁的逻辑封装，可以通过不同的DistributedLock实现不同的锁（可以是Redis、Zookeeper），这里主要是为了能够实现不同的close，即便是不同的分布式锁，close方法都封装在ILock中，使用时无需关心具体的是什么分布式锁，实现了<code>策略模式</code>。<br> 继承AutoCloseable很关键，使得 <code>try { ILock lock = distributedLock.tryLock(...); }</code> 具备自动释放资源的能力，而不用在finally手写资源释放close。</li><li>IDistributedLock 分布式锁操作接口 <figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> interface IDistributedLock&#123;<br>    ILock <span class="hljs-title function_">lock</span>(<span class="hljs-built_in">String</span> <span class="hljs-built_in">key</span>, <span class="hljs-type">long</span> leaseTime, TimeUnit unit, <span class="hljs-type">boolean</span> fair);<br>    ILock <span class="hljs-title function_">tryLock</span>(<span class="hljs-built_in">String</span> <span class="hljs-built_in">key</span>, <span class="hljs-type">long</span> tryTime, <span class="hljs-type">long</span> leaseTime, TimeUnit unit, <span class="hljs-type">boolean</span> fair) <span class="hljs-keyword">throws</span> Exception;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span>(<span class="hljs-built_in">Object</span> lock);<br>&#125;<br></code></pre></td></tr></table></figure></li><li>RedissonDistributedLock 实现 IDistributedLock 接口 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonDitributedLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDistributedLock</span>&#123;<br>    <span class="hljs-meta">@Resource</span><br>    RedissonClient redissonClient;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ILock <span class="hljs-title function_">lock</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> leaseTime, TimeUnit unit, <span class="hljs-type">boolean</span> fair)</span>&#123;<br>        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> fair? redissonClient.getFairLock(key) : redissonClient.getLock(key);<br>        lock.lock(leaseTime, unit);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ILock</span>(lock, <span class="hljs-built_in">this</span>);<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> ILock <span class="hljs-title function_">tryLock</span><span class="hljs-params">(String key, <span class="hljs-type">long</span> tryTime, <span class="hljs-type">long</span> leaseTime, TimeUnit unit, <span class="hljs-type">boolean</span> fair)</span>&#123;<br>        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> fair? redissonClient.getFairLock(key) : redissonClient.getLock(key);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">acquired</span> <span class="hljs-operator">=</span> lock.tryLock(tryTime, leaseTime, unit);<br>        <span class="hljs-keyword">if</span>(acquired)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ILock</span>(lock, <span class="hljs-built_in">this</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">(Object lock)</span>&#123;<br>        <span class="hljs-keyword">if</span>(lock instanceOf RLock)&#123;<br>            <span class="hljs-type">RLock</span> <span class="hljs-variable">rLock</span> <span class="hljs-operator">=</span> (RLock) lock;<br>            <span class="hljs-keyword">try</span>&#123;<br>                <span class="hljs-keyword">if</span>(rLock.islocked() &amp;&amp; rLock.isHeldByCurrentThread)&#123;<br>                    rLock.unlock();<br>                &#125;<br>            &#125;<span class="hljs-keyword">catch</span>(IllegalMonitorStateException e)&#123;<br>                log.warn(<span class="hljs-string">&quot;分布式锁释放失败：&#123;&#125;&quot;</span>, e.getMessage());<br>            &#125;<br>        &#125; <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>5.DistibutedLockAspect 切面 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributedLockAspect</span>&#123;<br>    <br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IDistributedLock distributedLock;<br>    <br>    <span class="hljs-meta">@around(@annoation(distributedLockAnno))</span><br>    <span class="hljs-keyword">private</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJointPoint jointPoint, DistributedLock distributedLockAnno)</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> parseKey(jointPoint, distributedLockAnno);<br>        <span class="hljs-type">ILock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span>&#123;<br>            lock = distributedLock.tryLock(<br>                    key,<br>                    distributedLockAnno.tryTime(),<br>                    distributedLockAnno.leaseTime(),<br>                    distributedLockAnno.unit(),<br>                    distributedLockAnno.fair()        <br>            );<br>            <span class="hljs-keyword">if</span>(lock == <span class="hljs-literal">null</span>)&#123;<br>                log.warn(<span class="hljs-string">&quot;未能获取到锁, &#123;&#125;&quot;</span>, key);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>            <br>            <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jointPoint.proceed(); <span class="hljs-comment">// 原本方法执行的结果</span><br>        &#125; <span class="hljs-keyword">finally</span>&#123;<br>            <span class="hljs-keyword">if</span> (lock != <span class="hljs-literal">null</span>) &#123;<br>                lock.close();<br>                log.info(<span class="hljs-string">&quot;🔓 已释放锁：&#123;&#125;&quot;</span>, key);<br>            &#125;<br>        &#125;<br><br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">parseKey</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, DistributedLock anno)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">spelKey</span> <span class="hljs-operator">=</span> anno.key();<br>        <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature) joinPoint.getSignature();<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> signature.getMethod();<br>        String[] paramNames = signature.getParameterNames();<br>        Object[] args = joinPoint.getArgs();<br><br>        <span class="hljs-type">EvaluationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StandardEvaluationContext</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; paramNames.length; i++) &#123;<br>            context.setVariable(paramNames[i], args[i]);<br>        &#125;<br><br>        <span class="hljs-type">Expression</span> <span class="hljs-variable">expression</span> <span class="hljs-operator">=</span> parser.parseExpression(spelKey);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> expression.getValue(context);<br>        <span class="hljs-keyword">return</span> anno.prefix() + Objects.toString(value);<br>    &#125;<br>    <br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>整体流程：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus">┌────────────────────────────┐<br>│ @<span class="hljs-built_in">DistributedLock</span>(key=<span class="hljs-string">&quot;#id&quot;</span>)│  ← 业务方法<br>└────────────┬───────────────┘<br>             │<br>             ▼<br>     <span class="hljs-selector-attr">[DistributedLockAspect]</span><br>             │<br>             ▼<br>     <span class="hljs-selector-attr">[IDistributedLock 接口]</span><br>             │<br>             ▼<br>     <span class="hljs-selector-attr">[RedissonDistributedLock]</span><br>             │<br>             ▼<br>     <span class="hljs-selector-attr">[Redis 实例]</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Redis + Lua 脚本实现计数器限流</title>
    <link href="/2025/10/09/2025-10-09-69/"/>
    <url>/2025/10/09/2025-10-09-69/</url>
    
    <content type="html"><![CDATA[<h1 id="Redis-Lua-脚本实现计数器限流"><a href="#Redis-Lua-脚本实现计数器限流" class="headerlink" title="Redis + Lua 脚本实现计数器限流"></a>Redis + Lua 脚本实现计数器限流</h1><h2 id="限流"><a href="#限流" class="headerlink" title="限流"></a>限流</h2><p>系统高并发的三大保障有：缓存、降级、<strong>限流</strong><br>限流：限制系统或者某个服务在<strong>单位时间内处理请求的数量</strong>，防止系统超负荷，保障服务正常运行。常用算法有：计数器、令牌桶和漏桶等。</p><p>限流中的两个概念：</p><ul><li><strong>阈值</strong>：比如将QPS限制为500，那么说明每秒处理500个请求，通过设置阈值，控制系统负载，达到防止超负荷的目的。</li><li><strong>拒绝策略</strong>：那么被阈值拒之门外的请求应该作何处理呢？拒绝策略提供了方案，常见的有：<ul><li><strong>直接拒绝</strong>：直接拒绝超过阈值的请求，不予处理。</li><li><strong>排队等待</strong>：将超过阈值的请求放入队列，等候处理。<br>不同业务场景下选择合适的拒绝策略能够提高用户的体验。</li></ul></li></ul><p>目前比较主流的两个限流方案</p><ul><li>网关层：限流在所有应用的入口处。</li><li>中间件限流：限流信息存储在中间件（如Redis）中，每个组件可以从此获得事实的限流信息，来决定操作。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//计数器限流示意</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Limiter</span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">limit</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">timeWindow</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> time;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">reqCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);<br>       <br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Limiter</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-built_in">this</span>.time = System.currentTimeMillis();<br>    &#125;<br>    <span class="hljs-comment">// 每次请求前使用</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">limit</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">if</span>(now &lt; time + timeWindow)&#123;<br>            reqCount.addAndGet(<span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">return</span> reqCount.get() &lt; limit;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">// 超出时间窗口，重新计数</span><br>            time = now;<br>            reqCount = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="什么是Lua脚本？"><a href="#什么是Lua脚本？" class="headerlink" title="什么是Lua脚本？"></a>什么是Lua脚本？</h2><p>一种轻量级、嵌入式脚本语言，常用游戏开发、脚本编程和嵌入式系统中。Redis从2.6开始支持Lua脚本，可以通过 EVAL 命令执行Lua脚本，实现原子操作，避免复杂的多步操作。<br>Lua脚本类似于MySQL的事务，存储一组指令，这些指令要么全部执行成功，要么全部失败，具有<strong>原子性</strong>，在开发中使用 Lua 脚本，可以将其看作是一段<strong>具有业务逻辑的代码块</strong>，因为我们需要用到原子性的一组操作，必然是业务需求。</p><p>Lua脚本在Redis中的好处：</p><ul><li><strong>原子性操作</strong></li><li><strong>减少网络开销</strong>：一次性组装多条命令，减少Redis通信开销</li><li><strong>便利复杂操</strong>：作实现复杂操作，原本Redis命令执行可能很繁琐</li></ul><p>常见使用场景：</p><ul><li><strong>分布式锁</strong>：Redisson 分布式锁底层就包括Lua脚本</li><li><strong>计数器限流</strong>：Lua脚本实现精确计数器限流，避免并发问题</li><li><strong>复杂事务</strong>：Lua脚本处理多步事务，保障操作完整性。</li></ul><h2 id="项目应用"><a href="#项目应用" class="headerlink" title="项目应用"></a>项目应用</h2><p>在项目中应用<strong>Redis+Lua</strong>脚本实现计数器限流，避免频繁等重复或者恶意的提交，减少系统的异常压力。我们不仅实现限流，还应用<strong>自定义注解</strong> + <strong>切面</strong>，实现灵活的限流。</p><h3 id="Lua-脚本配置"><a href="#Lua-脚本配置" class="headerlink" title="Lua 脚本配置"></a>Lua 脚本配置</h3><p>首先将脚本配置注入</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisRateLimiterConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">DefaultRedisScript</span>&lt;<span class="hljs-type">Long</span>&gt; limitScript() &#123;<br>        <span class="hljs-type">DefaultRedisScript</span>&lt;<span class="hljs-type">Long</span>&gt; redisScript <span class="hljs-operator">=</span> new <span class="hljs-type">DefaultRedisScript</span>&lt;&gt;();<br>        redisScript.setScriptText(limitScriptText());<br>        redisScript.setResultType(<span class="hljs-type">Long</span>.class);<br>        <span class="hljs-keyword">return</span> redisScript;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 限流Lua脚本（基于计数器算法）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> limitScriptText() &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;local key = KEYS[1]<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;local count = tonumber(ARGV[1])<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;local time = tonumber(ARGV[2])<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;local current = redis.call(&#x27;get&#x27;, key)<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;if current and tonumber(current) &gt; count then<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;    return tonumber(current)<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;end<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;current = redis.call(&#x27;incr&#x27;, key)<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;if tonumber(current) == 1 then<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;    redis.call(&#x27;expire&#x27;, key, time)<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;end<span class="hljs-subst">\n</span>&quot;</span> <span class="hljs-operator">+</span><br>                <span class="hljs-string">&quot;return tonumber(current)&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Lua 脚本流程：</p><ol><li>读取key计数</li><li>如果key存在，且值超过限制，返回计数，代表超出阈值</li><li>计数+1，如果不存在，计数会被设置为1</li><li>如果计数&#x3D;&#x3D;1，意味着是第一次访问，设置过期时间</li><li>返回计数</li></ol><h3 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs csharp">@Target(ElementType.METHOD) <span class="hljs-comment">// 表示只能用于方法</span><br>@Retention(RetentionPolicy.RUNTIME) <span class="hljs-comment">// 表示运行时存活，可被反射获取</span><br>@Documented<br><span class="hljs-keyword">public</span> @interface RateLimiter &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 限流key（前缀）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">String <span class="hljs-title">key</span>() <span class="hljs-literal">default</span> &quot;RATE_LIMIT:&quot;</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 限流时间窗口，单位秒</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">time</span>() <span class="hljs-literal">default</span> 60</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 限流次数</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-built_in">int</span> <span class="hljs-title">count</span>() <span class="hljs-literal">default</span> 100</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 限流类型（默认/按IP）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function">LimitType <span class="hljs-title">limitType</span>() <span class="hljs-literal">default</span> LimitType.DEFAULT</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="切面"><a href="#切面" class="headerlink" title="切面"></a>切面</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">private RedisTemplate&lt;<span class="hljs-keyword">Object</span>, <span class="hljs-keyword">Object</span>&gt; redisTemplate;<br>    private RedisScript&lt;Long&gt; limitScript;<br><br>    @Autowired<br>    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> setRedisTemplate(RedisTemplate&lt;<span class="hljs-keyword">Object</span>, <span class="hljs-keyword">Object</span>&gt; redisTemplate) &#123;<br>        this.redisTemplate = redisTemplate;<br>    &#125;<br><br>    @Autowired<br>    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> setLimitScript(RedisScript&lt;Long&gt; limitScript) &#123;<br>        this.limitScript = limitScript;<br>    &#125;<br><br>    @<span class="hljs-keyword">Before</span>(&quot;@annotation(rateLimiter)&quot;)<br>    <span class="hljs-built_in">public</span> <span class="hljs-type">void</span> doBefore(JoinPoint <span class="hljs-type">point</span>, RateLimiter rateLimiter) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-type">time</span> = rateLimiter.time();<br>        <span class="hljs-type">int</span> count = rateLimiter.count();<br>        String key = buildKey(rateLimiter, <span class="hljs-type">point</span>);<br><br>        List&lt;<span class="hljs-keyword">Object</span>&gt; keys = Collections.singletonList(key);<br>        Long <span class="hljs-keyword">current</span> = redisTemplate.<span class="hljs-keyword">execute</span>(limitScript, keys, count, <span class="hljs-type">time</span>);<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">current</span> == <span class="hljs-keyword">null</span> || <span class="hljs-keyword">current</span>.intValue() &gt; count) &#123;<br>            throw <span class="hljs-built_in">new</span> ServiceException(&quot;访问过于频繁，请稍候再试&quot;);<br>        &#125;<br>        <span class="hljs-keyword">log</span>.<span class="hljs-keyword">info</span>(&quot;🔒 限流：key=&#123;&#125;, 当前请求次数=&#123;&#125;, 限制次数=&#123;&#125;&quot;, key, <span class="hljs-keyword">current</span>, count);<br>    &#125;<br><br>    private String buildKey(RateLimiter rateLimiter, JoinPoint <span class="hljs-type">point</span>) &#123;<br>        StringBuilder sb = <span class="hljs-built_in">new</span> StringBuilder(rateLimiter.key());<br>        <span class="hljs-keyword">if</span> (rateLimiter.limitType() == LimitType.IP) &#123;<br>            sb.append(IpUtils.getIpAddr(ServletUtils.getRequest())).append(&quot;:&quot;);<br>        &#125;<br>        MethodSignature signature = (MethodSignature) <span class="hljs-type">point</span>.getSignature();<br>        <span class="hljs-keyword">Method</span> <span class="hljs-keyword">method</span> = signature.getMethod();<br>        sb.append(<span class="hljs-keyword">method</span>.getDeclaringClass().getName()).append(&quot;.&quot;).append(<span class="hljs-keyword">method</span>.getName());<br>        <span class="hljs-keyword">return</span> sb.toString();<br>    &#125;<br></code></pre></td></tr></table></figure><p>定义切面，执行带有@RateLimiter注解的方法之前，会先执行 doBefore，doBefore就是我们定义的限流逻辑：</p><ol><li>从注解ratelimiter类获取限流配置信息（底层是反射，这就是为什么<strong>注解周期要设置成运行时</strong>）</li><li>构造key，这里加入IP来构造，并且通过<strong>反射</strong>获取方法的所在类和方法名，结合构造，最终是RATE_LIMIT:IP:com.example.test.login 这种形式，以达到限制同一IP请求同一方法频率的目的。</li><li>执行Lua脚本限流逻辑，如果超出限制，抛出异常。</li></ol><p>如何分析改进策略？</p><ul><li>某接口限流次数很多（例如 &#x2F;login 被拒绝上千次）<br>说明限额太低或流量高峰明显<br>提高 count 或缩短 time</li><li>某些 IP 频繁被限流<br>说明有刷接口风险<br>对该 IP 单独设更低限额或拉黑</li><li>某时段（比如 9:00-9:30）限流集中<br>说明系统高峰期<br>调整限流窗口、引入“分时段动态限流”</li><li>限流接口都是低价值接口（如 &#x2F;ping）<br>说明资源浪费<br>可以放宽或取消限流</li><li>限流导致主业务接口大量被拒绝<br>说明策略太激进<br>调整全局限额或使用令牌桶平滑限流</li></ul>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>自己开发的动态线程池组件对接项目</title>
    <link href="/2025/04/10/2025-04-10-64/"/>
    <url>/2025/04/10/2025-04-10-64/</url>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mvn clean install<br></code></pre></td></tr></table></figure><p>打包好的动态线程池在本地maven仓库，这个时候可以在需要引入的项目的<code>pom</code>文件里导入动态线程池组件。</p><p>过程中需要注意的一点是，动态线程池使用了 Redissonclient，对接项目中也使用了 Redissonclient，刚开始运行的时候会发生系统不知道注入哪个 bean 的冲突，需要解决冲突。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>指定其中一个Redissonclient bean <code>@Primary</code>，或者是在所有需要注入 Redissonclient 的地方（在<code>@Resource</code>下面）加上<code>@Qualifier(bean名称)</code><br><img src="https://images/typecho//2025/04/2715596355.png" alt="2025-04-10T14:52:42.png"><br><img src="https://images/typecho//2025/04/3897093518.png" alt="2025-04-10T14:52:47.png"></p><p>运行程序，接着在动态线程池管理页面就可以动态监控、管理了。<br><img src="https://images/typecho//2025/04/3220638611.png" alt="2025-04-10T14:52:58.png"></p>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Typora 无限试用探索：通过修改配置文件日期实现 &amp;quot;续杯&amp;quot;</title>
    <link href="/2025/04/07/2025-04-07-57/"/>
    <url>/2025/04/07/2025-04-07-57/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文仅用于学习和研究，不建议绕过 Typora 的正版授权机制。请合理使用，支持优秀的软件开发者！</p></blockquote><hr><h2 id="一、项目背景"><a href="#一、项目背景" class="headerlink" title="一、项目背景"></a>一、项目背景</h2><p><a href="https://typora.io/">Typora</a> 是一款极致优雅的 Markdown 文档编辑器，并提供手写样台体高度达成的手写组织体验。</p><p>Typora 原本是免费软件，但在进入正式发布版本后，已改为付费软件，无论是 Windows 还是 macOS，都有试用时间限制。</p><h2 id="在试用期结束后，Typora-需要正版授权才能继续使用。那么，还有没有可能通过保留试用状态，实现同样效果的方法呢？"><a href="#在试用期结束后，Typora-需要正版授权才能继续使用。那么，还有没有可能通过保留试用状态，实现同样效果的方法呢？" class="headerlink" title="在试用期结束后，Typora 需要正版授权才能继续使用。那么，还有没有可能通过保留试用状态，实现同样效果的方法呢？"></a>在试用期结束后，Typora 需要正版授权才能继续使用。那么，还有没有可能通过保留试用状态，实现同样效果的方法呢？<br><img src="https://images/typecho//2025/04/3991686178.png" alt="2025-04-07T14:07:58.png"></h2><h2 id="二、Typora-配置文件分析"><a href="#二、Typora-配置文件分析" class="headerlink" title="二、Typora 配置文件分析"></a>二、Typora 配置文件分析</h2><p>Typora 在 Windows 上会把用户配置存储在</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">%APPDATA%\Typora\profile.data<br></code></pre></td></tr></table></figure><p>该文件本质是一个被 UTF-8 编码后再转换为 16 进制的 JSON 文件，我们可以将其转为 JSON，分析其中包含如下样的日期字段：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;_iD&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;3/18/2025&quot;</span><br></code></pre></td></tr></table></figure><p>非常明显，这是用于记录试用开始时间的字段。而 Typora 同步上下没有与服务器校验，那么，我们只需要修改这个日期，就有可能重新启动试用。</p><hr><h2 id="三、Python-脚本实现“日期重置试用”"><a href="#三、Python-脚本实现“日期重置试用”" class="headerlink" title="三、Python 脚本实现“日期重置试用”"></a>三、Python 脚本实现“日期重置试用”</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hex_to_json</span>(<span class="hljs-params">hex_str</span>):<br>    <span class="hljs-keyword">return</span> json.loads(<span class="hljs-built_in">bytes</span>.fromhex(hex_str).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">json_to_hex</span>(<span class="hljs-params">data</span>):<br>    json_str = json.dumps(data, separators=(<span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;:&#x27;</span>))<br>    <span class="hljs-keyword">return</span> json_str.encode(<span class="hljs-string">&#x27;utf-8&#x27;</span>).<span class="hljs-built_in">hex</span>()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_today_date_str</span>():<br>    today = datetime.today()<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;today.month&#125;</span>/<span class="hljs-subst">&#123;today.day&#125;</span>/<span class="hljs-subst">&#123;today.year&#125;</span>&quot;</span>  <span class="hljs-comment"># M/D/YYYY</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fix_path</span>(<span class="hljs-params">path: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> path.replace(<span class="hljs-string">&quot;\\&quot;</span>, <span class="hljs-string">&quot;\\\\&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    file_path = os.path.expandvars(<span class="hljs-string">r&quot;%APPDATA%\\Typora\\profile.data&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(file_path):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\u6587\u4ef6\u4e0d\u5b58\u5728\uff1a<span class="hljs-subst">&#123;file_path&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        hex_input = f.read().strip()<br><br>    <span class="hljs-keyword">try</span>:<br>        data = hex_to_json(hex_input)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\u89e3\u6790\u5931\u8d25\uff0c\u8bf7\u786e\u8ba4\u6587\u4ef6\u5185\u5bb9\u662f hex \u7f16\u7801\u7684 JSON\u3002&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\u9519\u8bef\u4fe1\u606f\uff1a&quot;</span>, e)<br>        <span class="hljs-keyword">return</span><br><br>    today_str = get_today_date_str()<br>    data[<span class="hljs-string">&quot;_iD&quot;</span>] = today_str<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\u5df2\u5c06 _iD \u66f4\u65b0\u4e3a\uff1a<span class="hljs-subst">&#123;today_str&#125;</span>&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;pinFolder&quot;</span> <span class="hljs-keyword">in</span> data:<br>        data[<span class="hljs-string">&quot;pinFolder&quot;</span>] = fix_path(data[<span class="hljs-string">&quot;pinFolder&quot;</span>])<br><br>    modified_hex = json_to_hex(data)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(modified_hex)<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\u4fee\u6539\u6210\u529f \u2705&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\u65b0\u5185\u5bb9\u5199\u5165\uff1a<span class="hljs-subst">&#123;file_path&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br></code></pre></td></tr></table></figure><hr><h2 id="四、实验效果"><a href="#四、实验效果" class="headerlink" title="四、实验效果"></a>四、实验效果</h2><ul><li>每次运行脚本后，Typora 重启后会重新进入试用状态</li><li>每日更新一次即可“续杯”</li></ul><hr><h2 id="五、结论-提示"><a href="#五、结论-提示" class="headerlink" title="五、结论 &amp; 提示"></a>五、结论 &amp; 提示</h2><ul><li><p>实现简单。Typora 试用状态存储于本地，无服务器校验</p></li><li><p>无需纯删除文件，只修改日期即可<br>-<u> <strong>支持开源优秀软件</strong>，Typora 值得购买</u></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>使用 Mosh：优化高延迟网络下的 SSH 连接体验</title>
    <link href="/2025/04/06/2025-04-06-54/"/>
    <url>/2025/04/06/2025-04-06-54/</url>
    
    <content type="html"><![CDATA[<h2 id="高延迟网络下糟糕的-SSH-体验"><a href="#高延迟网络下糟糕的-SSH-体验" class="headerlink" title="高延迟网络下糟糕的 SSH 体验"></a>高延迟网络下糟糕的 SSH 体验</h2><p>最近购入了一台 <strong>伦敦</strong> 的服务器，优点是便宜量大、相对稳定不丢包，缺点是<strong>延迟稳定的高</strong>，以至于在 SSH 连接使用服务器时，<u><strong>键盘输入延迟严重，丝毫不跟手</strong></u>，体验糟糕。<br>于是在网上搜索解决方案🔍，发现了一款宝藏引用 <code>Mosh</code>。<br><img src="https://images/typecho//2025/04/1033170522.png" alt="2025-04-06T09:53:57.png"></p><h2 id="Mosh"><a href="#Mosh" class="headerlink" title="Mosh"></a>Mosh</h2><p>在网络延迟较高或经常断线的环境中，传统 SSH 会话（如 Termius、OpenSSH）常常出现卡顿、掉线、粘贴延迟等问题。为此，推荐使用 Mosh（Mobile Shell） 来替代传统 SSH。</p><blockquote><p><strong>关于 Mosh（Mobile Shell）</strong></p><p>Mosh 是一种比 SSH 更适合远程连接的终端工具，尤其适用于高延迟、不稳定网络环境。它支持断网重连、IP 变更不中断连接，并提供更流畅的打字体验。</p><p>相较于传统 SSH，Mosh 使用 UDP 协议，通过本地预回显机制让输入响应几乎无延迟。</p><p>官网：<a href="https://mosh.org/">https://mosh.org/</a></p><p>安装方法（Ubuntu）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt install mosh<br></code></pre></td></tr></table></figure><p>使用方式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mosh username@server --ssh=<span class="hljs-string">&#x27;ssh -p 2222&#x27;</span><br></code></pre></td></tr></table></figure><p>注意：需要开放 UDP 60000-61000 端口，服务端也需安装 mosh。</p></blockquote><p>✅ Mosh 的优势</p><ul><li><p>容错强：连接中断后自动重连（即使你换了 IP）</p></li><li><p>低延迟响应：本地预输入回显，打字不卡顿</p></li><li><p>适合不稳定网络：如移动网络、海外跳板机、4G 服务器场景</p></li></ul><h2 id="Termius-中的方便使用"><a href="#Termius-中的方便使用" class="headerlink" title="Termius 中的方便使用"></a>Termius 中的方便使用</h2><p><code>Termius</code> 是一款强大的 SSH 客户端，支持开启 <code>Mosh</code> 优化高延的服务器连接。<br>开启方法：<br>    1. 编辑服务器设置。<br>    2. 在配置的最下方找到 Mosh 设置，选择 <code>Enable</code> 打开即可。<br>    3. 点击 <code>Connect</code> 连接，后续的连接将通过 Mosh 实现。<br><img src="https://images/typecho//2025/04/3150756892.png" alt="2025-04-06T09:50:06.png"></p><p>实测在高延迟的<strong>伦敦</strong>服务器连接中，也能够<u><strong>实现良好的键盘输入跟手体验</strong></u>。</p>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>记一次SSH爆破排查以及解决方案</title>
    <link href="/2025/04/06/2025-04-06-50/"/>
    <url>/2025/04/06/2025-04-06-50/</url>
    
    <content type="html"><![CDATA[<h2 id="问题发现"><a href="#问题发现" class="headerlink" title="问题发现"></a>问题发现</h2><p>最近在使用服务器的时候也了解到一些相关云服务器安全问题，于是进行了排查，发现了疑似 <code>SSH 爆破</code>的攻击，便展开排查处理，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> ss -tan state established<br></code></pre></td></tr></table></figure><p>![2025-04-06T09:21:55.png][1]<br>发现疑似爆破行为存在，进一步查看日志：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tail</span> -f /var/log/auth.log<br></code></pre></td></tr></table></figure><p>![2025-04-06T09:24:42.png][2]<br>发现可疑 ip 在尝试爆破，需要为 <code>SSH</code> 增加防护措施。</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>安装 <code>fail2ban</code> 。</p><blockquote><p><a href="https://www.fail2ban.org/">Fail2ban</a> 是一款轻量级的服务器安全工具，专门用于<strong>检测暴力破解行为并自动封禁攻击 IP</strong>。<br>它的工作流程：</p></blockquote><blockquote><ol><li>实时监控系统日志（如 <code>/var/log/auth.log</code>）；</li><li>发现异常行为（如 SSH 登录失败次数过多）；</li><li>自动通过 <code>iptables</code> 或 <code>firewalld</code> 拉黑该 IP，一般封禁时间为 10 分钟至数小时。</li></ol></blockquote><blockquote><p>Fail2ban 支持多种服务（如 sshd、nginx、vsftpd、mysql 等）监控规则，非常适合部署在公网服务器上作为第一道防线。</p></blockquote><blockquote><p>优点：</p><ul><li>✦ 安装简单（<code>apt install fail2ban -y</code>）</li><li>✦ 默认即可生效</li><li>✦ 支持配置自定义策略（封禁阈值、持续时间、邮件通知等）</li></ul></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt update<br>apt install fail2ban -y<br>systemctl <span class="hljs-built_in">enable</span> fail2ban<br>systemctl start fail2ban<br></code></pre></td></tr></table></figure><p>效果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">fail2ban-cilent status sshd<br></code></pre></td></tr></table></figure><p>![2025-04-06T09:21:03.png][3]</p><p>已经自动封禁 <code>违规ip</code> ，提升了 <code>SSH</code> 的 <strong>安全性</strong>。在做</p><h2 id="进一步的安全性"><a href="#进一步的安全性" class="headerlink" title="进一步的安全性"></a>进一步的安全性</h2><p>此外，如果还要进一步提升 <code>SSH</code> 的安全性，有如下措施：</p><ul><li>禁止 <code>root</code> 用户登录。</li><li>禁止 <code>密码</code> 登录，通过 <code>密钥</code> 登录。</li><li>修改默认 SSH <code>端口</code>。</li><li>如果是 <code>固定 IP</code> 登录服务器，也可以限制登录源 IP。</li><li>定期 <code>日志审计</code> ，识别可疑尝试。<br>[1]: https:&#x2F;&#x2F;&#x2F;images&#x2F;typecho&#x2F;&#x2F;2025&#x2F;04&#x2F;4060019133.png<br><br>[2]: https:&#x2F;&#x2F;&#x2F;images&#x2F;typecho&#x2F;&#x2F;2025&#x2F;04&#x2F;1955318361.png<br><br>[3]: https:&#x2F;&#x2F;&#x2F;images&#x2F;typecho&#x2F;&#x2F;2025&#x2F;04&#x2F;1638401865.png</li></ul>]]></content>
    
    
    <categories>
      
      <category>网站运维</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MarkNote 开发历程：从零开始的桌面便签应用开发</title>
    <link href="/2025/04/04/2025-04-04-47/"/>
    <url>/2025/04/04/2025-04-04-47/</url>
    
    <content type="html"><![CDATA[<h2 id="项目展示"><a href="#项目展示" class="headerlink" title="项目展示"></a>项目展示</h2><p><img src="https://images/typecho//2025/04/601261715.png" alt="2025-04-03T16:46:01.png"><br><img src="https://images/typecho//2025/04/394463393.png" alt="2025-04-03T16:46:12.png"></p><h2 id="项目起源"><a href="#项目起源" class="headerlink" title="项目起源"></a>项目起源</h2><p>支持 Markdown 语法的轻量桌面便签。</p><p>在开发 MarkNote 之前，我一直在寻找一个简单但功能强大的桌面便签应用。市面上的便签应用要么过于简单，要么过于复杂。于是我决定自己开发一个既轻量又实用的便签应用。</p><h2 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h2><ul><li><strong>开发语言</strong>: Python</li><li><strong>GUI 框架</strong>: PyQt5</li><li><strong>开发工具</strong>: Cursor IDE</li><li><strong>构建工具</strong>: PyInstaller</li></ul><h2 id="开发历程"><a href="#开发历程" class="headerlink" title="开发历程"></a>开发历程</h2><h3 id="1-基础框架搭建"><a href="#1-基础框架搭建" class="headerlink" title="1. 基础框架搭建"></a>1. 基础框架搭建</h3><p>首先创建了基本的 GUI 框架，包括：</p><ul><li>主窗口布局</li><li>系统托盘集成</li><li>单例模式实现</li><li>基础的文件保存&#x2F;加载功能</li></ul><h3 id="2-Markdown-功能实现"><a href="#2-Markdown-功能实现" class="headerlink" title="2. Markdown 功能实现"></a>2. Markdown 功能实现</h3><p>这是最具挑战性的部分之一：</p><ul><li>使用 QWebEngineView 实现 Markdown 渲染</li><li>添加实时预览功能</li><li>实现代码高亮</li><li>优化渲染性能</li></ul><h3 id="3-待办事项功能"><a href="#3-待办事项功能" class="headerlink" title="3. 待办事项功能"></a>3. 待办事项功能</h3><p>添加了 To-Do List 功能：</p><ul><li>支持添加&#x2F;删除待办事项</li><li>复选框状态管理</li><li>数据持久化存储</li></ul><h3 id="4-UI-UX-优化"><a href="#4-UI-UX-优化" class="headerlink" title="4. UI&#x2F;UX 优化"></a>4. UI&#x2F;UX 优化</h3><p>持续改进用户界面：</p><ul><li>优化顶部栏设计</li><li>添加图标和视觉反馈</li><li>实现窗口拖拽和调整大小</li><li>添加固定位置功能</li></ul><h3 id="5-配置系统"><a href="#5-配置系统" class="headerlink" title="5. 配置系统"></a>5. 配置系统</h3><p>实现完整的配置管理：</p><ul><li>自定义保存路径</li><li>开机自启动选项</li><li>字体设置</li><li>窗口位置记忆</li></ul><h3 id="6-项目重构与重命名"><a href="#6-项目重构与重命名" class="headerlink" title="6. 项目重构与重命名"></a>6. 项目重构与重命名</h3><p>将项目从 StickyNote 重命名为 MarkNote：</p><ul><li>更新所有相关文件名</li><li>修改代码中的引用</li><li>更新文档和说明</li><li>调整 GitHub 仓库设置</li></ul><h2 id="技术难点与解决方案"><a href="#技术难点与解决方案" class="headerlink" title="技术难点与解决方案"></a>技术难点与解决方案</h2><h3 id="1-Markdown-渲染性能"><a href="#1-Markdown-渲染性能" class="headerlink" title="1. Markdown 渲染性能"></a>1. Markdown 渲染性能</h3><p><strong>问题</strong>: 实时渲染导致界面卡顿</p><p><strong>解决方案</strong>: </p><ul><li>使用 QTimer 实现延迟渲染</li><li>优化渲染逻辑</li><li>添加缓存机制</li></ul><h3 id="2-数据持久化"><a href="#2-数据持久化" class="headerlink" title="2. 数据持久化"></a>2. 数据持久化</h3><p><strong>问题</strong>: 需要可靠的数据保存机制</p><p><strong>解决方案</strong>:</p><ul><li>使用 INI 文件格式存储数据</li><li>实现自动保存功能</li><li>添加数据备份机制</li></ul><h3 id="3-系统托盘集成"><a href="#3-系统托盘集成" class="headerlink" title="3. 系统托盘集成"></a>3. 系统托盘集成</h3><p><strong>问题</strong>: 托盘图标管理复杂</p><p><strong>解决方案</strong>:</p><ul><li>实现托盘菜单</li><li>优化图标显示</li><li>添加快捷操作</li></ul><h2 id="开发工具与效率"><a href="#开发工具与效率" class="headerlink" title="开发工具与效率"></a>开发工具与效率</h2><p>使用 Cursor IDE 进行开发，它提供了：</p><ul><li>AI 辅助编程</li><li>智能代码补全</li><li>实时代码分析</li><li>快速重构工具</li></ul><h2 id="项目发布"><a href="#项目发布" class="headerlink" title="项目发布"></a>项目发布</h2><ol><li>创建 GitHub 仓库</li><li>编写详细文档</li><li>打包发布</li><li>持续维护和更新</li></ol><h2 id="未来展望"><a href="#未来展望" class="headerlink" title="未来展望"></a>未来展望</h2><p>计划添加的功能：</p><ul><li>多主题支持</li><li>云同步</li><li>快捷键自定义</li><li>插件系统</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过这个项目，我不仅开发了一个实用的工具，也学到了很多：</p><ul><li>PyQt5 开发经验</li><li>Python 项目结构</li><li>Git 版本控制</li><li>软件发布流程</li></ul><p>这个项目展示了从零开始开发一个完整桌面应用的全过程，也让我体会到了编程的乐趣。</p><h2 id="项目链接"><a href="#项目链接" class="headerlink" title="项目链接"></a>项目链接</h2><ul><li><p>GitHub: <a href="https://github.com/xyooz/MarkNote">MarkNote</a><br>Releases: <a href="https://github.com/xyooz/MarkNote/releases">下载页面</a></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Debian12/Ubuntu22.04 安装 Docker Docker-Compose</title>
    <link href="/2025/03/16/2025-03-16-25/"/>
    <url>/2025/03/16/2025-03-16-25/</url>
    
    <content type="html"><![CDATA[<p><a href="https://u.sb/debian-install-docker/">参考</a><br><em>也适用于 Debian 11 以及 Ubuntu 20.04, Ubuntu 22.04</em></p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">apt <span class="hljs-keyword">update</span><br>apt upgrade -<span class="hljs-keyword">y</span><br>apt install curl <span class="hljs-keyword">vim</span> wget gnupg dpkg apt-transport-https lsb-release <span class="hljs-keyword">ca</span>-certificates<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">curl -sS https:<span class="hljs-regexp">//</span>download.docker.com<span class="hljs-regexp">/linux/</span>debian<span class="hljs-regexp">/gpg | gpg --dearmor &gt; /u</span>sr<span class="hljs-regexp">/share/</span>keyrings/docker-ce.gpg<br>echo <span class="hljs-string">&quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-ce.gpg] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/debian $(lsb_release -sc) stable&quot;</span> &gt; <span class="hljs-regexp">/etc/</span>apt<span class="hljs-regexp">/sources.list.d/</span>docker.list<br></code></pre></td></tr></table></figure><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stata">apt <span class="hljs-keyword">update</span><br>apt install docker-ce docker-ce-<span class="hljs-keyword">cli</span> containerd.io docker-compose-<span class="hljs-keyword">plugin</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>在服务器使用 Ollama 本地部署 DeepSeek-r1:8b 模型</title>
    <link href="/2025/02/05/2025-02-05-61/"/>
    <url>/2025/02/05/2025-02-05-61/</url>
    
    <content type="html"><![CDATA[<blockquote><p>本文记录在实验室服务器上部署本地大语言模型 <code>deepseek-r1:8b</code> 的完整过程。通过 <code>Ollama</code> 实现模型拉取和运行，限制 API 只能本地访问，同时集成 <code>OpenWebUI</code> 作为可视化前端，构建一个私密、安全、稳定的本地大模型平台。</p></blockquote><p>展示：<br><img src="https://images/typecho//2025/04/2731588404.png" alt="2025-04-09T17:10:17.png"><br>点击访问 <a href="https://deepseek.seeu.eu.org/">Deepseek-r1:8b</a></p><h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><p>实验室近期需要部署一个本地的大语言模型来进行代码生成类实验。考虑到以下几点：</p><ul><li>对话能力强，尤其偏向代码编写</li><li>模型能运行在消费级或普通科研服务器（如 1～2 张 3090）</li><li>安全性高，不暴露 API 给公网</li><li>可通过 Web 界面直接访问模型</li></ul><p>最终选择使用：</p><ul><li>模型：<a href="https://huggingface.co/deepseek-ai/deepseek-coder-7b-base"><code>deepseek-coder:7b</code></a></li><li>后端：<a href="https://ollama.com/"><code>Ollama</code></a></li><li>前端：<a href="https://github.com/open-webui/open-webui"><code>OpenWebUI</code></a></li></ul><hr><h2 id="Ollama-安装与部署"><a href="#Ollama-安装与部署" class="headerlink" title="Ollama 安装与部署"></a>Ollama 安装与部署</h2><h3 id="1-安装-Ollama"><a href="#1-安装-Ollama" class="headerlink" title="1. 安装 Ollama"></a>1. 安装 Ollama</h3><p>Ollama 提供了简洁的 CLI 工具用于运行 LLM，本地下载即可运行。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Ubuntu / Debian</span><br>curl -fsSL https://ollama.com/install.sh | sh<br><br><span class="hljs-comment"># 验证安装成功</span><br>ollama --version<br></code></pre></td></tr></table></figure><h3 id="2-拉取模型"><a href="#2-拉取模型" class="headerlink" title="2. 拉取模型"></a>2. 拉取模型</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ollama pull deepseek-r1:8b<br></code></pre></td></tr></table></figure><h3 id="安全策略"><a href="#安全策略" class="headerlink" title="安全策略"></a>安全策略</h3><p>为了保证服务器安全，我们不对外暴露 Ollama API 接口，仅开放本地 localhost:11434，这样即使服务器有公网 IP，模型服务也不会被外部访问。</p><h3 id="集成-OpenWebUI-前端界面"><a href="#集成-OpenWebUI-前端界面" class="headerlink" title="集成 OpenWebUI 前端界面"></a>集成 OpenWebUI 前端界面</h3><p>为了方便交互使用，部署开源的可视化前端：OpenWebUI，支持直接连接 Ollama。</p><ol><li>Docker 启动<br>官网命令：</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d -p 3000:8080 --gpus all --add-host=host.docker.internal:host-gateway -v open-webui:/app/backend/data --name open-webui --restart always ghcr.io/open-webui/open-webui:cuda<br></code></pre></td></tr></table></figure><ol start="2"><li>登录使用<br>实验室服务器打开 <a href="http://localhost:3000/">http://localhost:3000</a> 即可访问 OpenWebUI，首次使用需注册用户账号，之后即可登录使用。</li><li>域名访问<br>使用 Caddy 配置域名反向代理到 OpenWebUI 端口，实现通过域名访问，方便大家使用。Caddy 自动支持 HTTPS，基于 Go 编写，是一个非常好用的轻量网站服务。</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">deepseek.example.com &#123;<br>    reverse_proxy localhost:3000<br>&#125;<br><br></code></pre></td></tr></table></figure><p><img src="https://images/typecho//2025/04/2477342134.png" alt="2025-04-09T16:55:22.png"></p>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>解决 Git 错误：gnutls_handshake() failed</title>
    <link href="/2024/08/12/2024-08-12-20/"/>
    <url>/2024/08/12/2024-08-12-20/</url>
    
    <content type="html"><![CDATA[<p>更新 Git 版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt-get update<br>apt-get install git<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>网站运维</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>宝塔面板编译安装MySQL弹出最低内存限制</title>
    <link href="/2024/07/25/2024-07-25-6/"/>
    <url>/2024/07/25/2024-07-25-6/</url>
    
    <content type="html"><![CDATA[<p>当服务器配置不高时，编译安装MySQL 5.7弹窗“至少需要内存1560MB才能安装！”<br>解决方法：<br>进入宝塔面板–&gt;文件–&gt;&#x2F;www&#x2F;server&#x2F;panel&#x2F;class&#x2F;panelPlugin.py<br>找到代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-variable language_">self</span>.check_mem_limit(versionInfo[<span class="hljs-string">&#x27;mem_limit&#x27;</span>]):<br>  limit_list.append(<span class="hljs-string">&#x27;[&#123;&#125;MB]内存&#x27;</span>.<span class="hljs-built_in">format</span>(versionInfo[<span class="hljs-string">&#x27;mem_limit&#x27;</span>]))<br></code></pre></td></tr></table></figure><p>注释掉，同理最低CPU核心限制一样，注释掉对应代码就可以。<br><u>修改后，注意⚠<strong>重启宝塔面板生效</strong>。</u><br>重启后安装，控制台仍然报错，点击进入<strong>详情</strong>，提示执行 ******* 命令后可以进行<strong>强行安装</strong>，在终端执行命令后，再次进行编译安装，安装即可正常开始。</p>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
      <category>网站运维</category>
      
    </categories>
    
    
    <tags>
      
      <tag>宝塔面板</tag>
      
      <tag>服务器管理</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Caddy 与 Cloudflare 配置陷阱：HTTPS 重定向循环</title>
    <link href="/2024/06/25/2024-06-25-59/"/>
    <url>/2024/06/25/2024-06-25-59/</url>
    
    <content type="html"><![CDATA[<h2 id="Caddy-与-Cloudflare-配置陷阱：HTTPS-重定向循环"><a href="#Caddy-与-Cloudflare-配置陷阱：HTTPS-重定向循环" class="headerlink" title="Caddy 与 Cloudflare 配置陷阱：HTTPS 重定向循环"></a>Caddy 与 Cloudflare 配置陷阱：HTTPS 重定向循环</h2><p>在使用 Caddy 搭建网站并启用 Cloudflare CDN 时，遇到了一个奇怪的问题——浏览器提示 “Too many redirects”。</p><h2 id="问题所在-Caddy-Cloudflare-Flexible-SSL-会发生什么？"><a href="#问题所在-Caddy-Cloudflare-Flexible-SSL-会发生什么？" class="headerlink" title="问题所在 Caddy + Cloudflare Flexible SSL 会发生什么？"></a>问题所在 Caddy + Cloudflare Flexible SSL 会发生什么？</h2><p>当 Cloudflare 向源服务器发送请求时（Flexible 模式），它发的是 HTTP 请求，而 Caddy 会默认重定向到 HTTPS（因为它认为你要安全地访问站点）。</p><p>这就造成了一个死循环：</p><ol><li><p>用户访问 <a href="https://example.com./">https://example.com。</a></p></li><li><p>Cloudflare 接收请求，按 Flexible 设置，用 HTTP 访问你的源服务器。</p></li><li><p>Caddy 接收到 HTTP 请求，自动将其重定向到 HTTPS。</p></li><li><p>Cloudflare 接收到重定向，再次使用 HTTP 请求访问源服务器。</p></li><li><p>Caddy 继续<strong>重定向</strong>…… 循环往复。</p></li></ol><p><img src="https://images/typecho//2025/04/770728286.png" alt="2025-04-09T16:24:57.png"></p><h2 id="正确做法"><a href="#正确做法" class="headerlink" title="正确做法"></a>正确做法</h2><p>将 Cloudflare 的 SSL 模式设置为 <code>完全(Full)</code> 或 Full (Strict)。<br>这将保证 Cloudflare 与 Caddy 之间的通信也是通过 HTTPS，彻底解决重定向循环问题。</p>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>欢迎使用 Typecho</title>
    <link href="/2024/06/22/2024-06-22-start/"/>
    <url>/2024/06/22/2024-06-22-start/</url>
    
    <content type="html"><![CDATA[<p>如果您看到这篇文章,表示您的 blog 已经安装成功.</p>]]></content>
    
    
    <categories>
      
      <category>默认分类</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
